# Compound Engineering 五大工作流 — 依赖与文档矩阵

> **基于**: Compound Engineering Plugin v2.28.0
> **生成日期**: 2026-02-02

---

## 表格 1: 五大工作流的 Agent 依赖

| 工作流 | Agent 名称 | 类别 | 调度方式 | 职责 |
|--------|-----------|------|---------|------|
| **brainstorm** | `repo-research-analyst` | research | 始终运行 | 查找现有模式、CLAUDE.md 指南 |
| **plan** | `repo-research-analyst` | research | 始终并行 | 分析现有模式、评估技术熟悉度 |
| **plan** | `learnings-researcher` | research | 始终并行 | 搜索 `docs/solutions/` 中已记录的解决方案 |
| **plan** | `best-practices-researcher` | research | 条件性(高风险/不确定时) | 查找行业最佳实践 |
| **plan** | `framework-docs-researcher` | research | 条件性(高风险/不确定时) | 搜索框架官方文档 |
| **plan** | `spec-flow-analyzer` | workflow | 始终运行(顺序,在研究后) | 验证规范、识别缺口和边缘案例 |
| **work** | `code-simplicity-reviewer` | review | 可选(复杂/风险变更) | 检查不必要的复杂性 |
| **work** | `kieran-rails-reviewer` | review | 可选(复杂/风险变更) | 验证 Rails 约定 |
| **work** | `performance-oracle` | review | 可选(性能关键代码) | 检查性能问题 |
| **work** | `security-sentinel` | review | 可选(安全敏感变更) | 扫描安全漏洞 |
| **work** | `cora-test-reviewer` | review | 可选(全面测试覆盖项目) | 审查测试质量 |
| **work** | `figma-design-sync` | design | 可选(有 Figma 设计的 UI 工作) | 比较实现与设计差异 |
| **work** | `lint` | workflow | 始终(推送前) | 运行 linting 检查 |
| **review** | `kieran-rails-reviewer` | review | 核心并行(始终) | Rails 代码审查 |
| **review** | `dhh-rails-reviewer` | review | 核心并行(始终) | DHH 风格 Rails 审查 |
| **review** | `git-history-analyzer` | research | 核心并行(始终) | Git 历史分析 |
| **review** | `pattern-recognition-specialist` | review | 核心并行(始终) | 模式识别与反模式检测 |
| **review** | `architecture-strategist` | review | 核心并行(始终) | 架构策略分析 |
| **review** | `security-sentinel` | review | 核心并行(始终) | 安全漏洞扫描 |
| **review** | `performance-oracle` | review | 核心并行(始终) | 性能分析 |
| **review** | `data-integrity-guardian` | review | 核心并行(始终) | 数据完整性检查 |
| **review** | `agent-native-reviewer` | review | 核心并行(始终) | 验证 AI 代理可访问性 |
| **review** | `dependency-detective` | review | 核心并行(始终) | 依赖分析 |
| **review** | `code-philosopher` | review | 核心并行(始终) | 代码哲学审查 |
| **review** | `devops-harmony-analyst` | review | 核心并行(始终) | DevOps 和谐分析 |
| **review** | `code-simplicity-reviewer` | review | 始终(简化审查阶段) | 简化代码审查 |
| **review** | `data-migration-expert` | review | 条件性(PR 含数据库迁移) | 验证数据迁移安全性 |
| **review** | `deployment-verification-agent` | review | 条件性(PR 含数据库迁移) | 创建部署 Go/No-Go 检查清单 |
| **review** | `rails-turbo-expert` | review | 条件性(PR 使用 Turbo) | Turbo 框架审查 |
| **compound** | `performance-oracle` | review | 条件性(performance_issue) | 验证性能优化方案 |
| **compound** | `security-sentinel` | review | 条件性(security_issue) | 验证安全方案 |
| **compound** | `data-integrity-guardian` | review | 条件性(database_issue) | 审查数据库相关方案 |
| **compound** | `cora-test-reviewer` | review | 条件性(test_failure) | 创建预防测试用例 |
| **compound** | `kieran-rails-reviewer` | review | 条件性(代码密集型) | 审查代码示例 |
| **compound** | `code-simplicity-reviewer` | review | 条件性(代码密集型) | 确保方案简洁 |
| **compound** | `pattern-recognition-specialist` | review | 可选(增强) | 识别反模式 |
| **compound** | `best-practices-researcher` | research | 可选(增强) | 丰富最佳实践 |
| **compound** | `every-style-editor` | workflow | 可选(增强) | 文档风格验证 |
| **compound** | `framework-docs-researcher` | research | 可选(增强) | 链接框架文档引用 |

---

## 表格 2: 五大工作流的 Command 依赖

| 工作流 | Command 名称 | 关系类型 | 说明 |
|--------|-------------|---------|------|
| **brainstorm** | `/workflows:plan` | 下游衔接 | 设计完成后建议运行 |
| **plan** | `/deepen-plan` | 生成后选项 | 通过并行研究代理增强计划各节 |
| **plan** | `/plan_review` | 生成后选项 | 从审查者获得反馈 |
| **plan** | `/workflows:work` | 下游衔接 | 开始本地实现 |
| **work** | `/workflows:review` | 下游衔接 | PR 创建后建议运行 |
| **review** | `/triage` | 下游衔接 | 分类所有待办事项 |
| **review** | `/resolve_todo_parallel` | 下游衔接 | 批量修复待办事项 |
| **review** | `/test-browser` | 可选(Web 项目) | 浏览器端到端测试 |
| **review** | `/xcode-test` | 可选(iOS 项目) | Xcode 模拟器测试 |
| **compound** | `/workflows:plan` | 关联引用 | 规划时参考已文档化的解决方案 |

---

## 表格 3: 五大工作流的 Skill 依赖

| 工作流 | Skill 名称 | 用途 | 必要性 |
|--------|-----------|------|--------|
| **brainstorm** | `brainstorming` | 提供提问技巧、方案探索模式、YAGNI 原则、设计文档模板 | 核心依赖 |
| **work** | `git-worktree` | 创建隔离的工作树进行并行开发 | 可选(推荐) |
| **work** | `agent-browser` | 捕获 UI 截图(开发服务器页面) | 可选(UI 工作时必需) |
| **review** | `git-worktree` | 在隔离工作树中进行代码审查 | 可选(非目标分支时推荐) |
| **review** | `file-todos` | 创建结构化待办文件、提供模板和命名约定 | 核心依赖 |
| **compound** | `compound-docs` | 提供解决方案文档 schema、模板和分类体系 | 核心依赖(Routes To) |

---

## 表格 4: 五大工作流的输入/输出文档矩阵

| 工作流 | 输入文档 | 输入来源 | 输出文档 | 输出路径 |
|--------|---------|---------|---------|---------|
| **brainstorm** | 用户提供的功能想法/问题描述(文本) | 用户口头或命令参数 | 设计探索文档 | `docs/brainstorms/YYYY-MM-DD-<topic>-brainstorm.md` |
| **plan** | ① 功能描述/Bug 报告/改进想法(文本) | 用户参数 | 实现计划文档(MINIMAL/MORE/A LOT) | `docs/plans/YYYY-MM-DD-<type>-<name>-plan.md` |
| **plan** | ② 设计探索文档(可选,自动检测) | `docs/brainstorms/*.md`(14 天内) | — | — |
| **plan** | ③ 已有解决方案知识(自动搜索) | `docs/solutions/**/*.md` | — | — |
| **work** | ① 计划文件/规范/待办文件 | `docs/plans/*.md` 或 `todos/*.md` | 代码变更 + 增量提交 | 项目源码目录(git tracked) |
| **work** | — | — | Pull Request | GitHub PR（含截图） |
| **work** | — | — | 计划文件中的复选框更新 | 原 `docs/plans/*.md`（`[ ]` → `[x]`） |
| **review** | ① PR 编号/GitHub URL/分支名 | GitHub PR 元数据 | 结构化待办文件 | `todos/{id}-pending-{priority}-{desc}.md` |
| **review** | ② PR diff + 代码内容(自动获取) | git diff / gh pr view | 审查摘要报告 | 终端输出（非持久化） |
| **compound** | ① 可选的简要上下文(文本) | 用户参数 | 解决方案知识文档 | `docs/solutions/[category]/[filename].md` |
| **compound** | ② 对话历史(隐式自动提取) | 当前会话上下文 | — | — |

---

## 表格 5: 工作流间的文档流转关系（知识链路）

| 上游工作流 | 输出文档 | 下游工作流 | 如何消费 |
|-----------|---------|-----------|---------|
| **brainstorm** | `docs/brainstorms/*.md` | **plan** | 自动检测 14 天内匹配的设计文档，提取关键决策，跳过细化问题 |
| **plan** | `docs/plans/*.md` | **work** | 作为执行输入，分解为 TodoWrite 任务，按优先级逐项实现 |
| **work** | GitHub PR | **review** | 作为审查目标，获取 PR 元数据和 diff 内容 |
| **review** | `todos/*.md` | **work**（修复循环） | 通过 `/resolve_todo_parallel` 批量修复，或手动处理 |
| **compound** | `docs/solutions/**/*.md` | **plan** | `learnings-researcher` 自动搜索已有知识，避免重复劳动 |
| **compound** | `docs/solutions/**/*.md` | 未来所有工作流 | 作为可搜索的知识库持续复合 |

---

## 总结: 知识体系提取框架

基于以上分析，从存量项目/代码中提取知识体系可以按以下维度进行：

| 维度 | 对应目录 | 存量项目中的提取来源 |
|------|---------|-------------------|
| **设计决策层** | `docs/brainstorms/` | 项目 RFC、设计文档、ADR（Architecture Decision Records） |
| **实现计划层** | `docs/plans/` | Issue、Epic、技术方案、PRD |
| **代码实现层** | 源码 + PR | 现有代码库本身 |
| **审查发现层** | `todos/` | PR review comments、代码审计报告、tech debt backlog |
| **解决方案层** | `docs/solutions/` | 团队 Wiki、Slack 问答、Postmortem、Runbook |

关键的知识闭环：**compound 输出的 `docs/solutions/` 反馈到 plan 阶段的 `learnings-researcher`**，使每一次问题解决都能加速后续工作。
