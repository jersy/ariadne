# Claude Code æœ€ä½³å®è·µä¸ä½¿ç”¨æŒ‡å—

> **æ–‡æ¡£ç‰ˆæœ¬**: åŸºäº Compound Engineering Plugin v2.28.0 ä¸ Everything Claude Code
> **ç”Ÿæˆæ—¥æœŸ**: 2026-01-31
> **é€‚ç”¨èŒƒå›´**: Claude Code CLIã€OpenCodeã€Codex ä¸‰å¤§å¹³å°

---

## ç›®å½•

- [1. å¿«é€Ÿå…¥é—¨ (5 åˆ†é’Ÿæ•™ç¨‹)](#1-å¿«é€Ÿå…¥é—¨-5-åˆ†é’Ÿæ•™ç¨‹)
- [2. äº”å¤§çœŸå®åœºæ™¯å®æˆ˜ç¤ºä¾‹](#2-äº”å¤§çœŸå®åœºæ™¯å®æˆ˜ç¤ºä¾‹)
- [3. å·¥ä½œæµä¸ä»£ç†é€‰æ‹©æŒ‡å—](#3-å·¥ä½œæµä¸ä»£ç†é€‰æ‹©æŒ‡å—)
- [4. å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ](#4-å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ)
- [5. æ•ˆç‡æå‡çš„ 10 æ¡é»„é‡‘æ³•åˆ™](#5-æ•ˆç‡æå‡çš„-10-æ¡é»„é‡‘æ³•åˆ™)
- [6. å¸¸è§é—®é¢˜è§£ç­” (FAQ)](#6-å¸¸è§é—®é¢˜è§£ç­”-faq)

---

## 1. å¿«é€Ÿå…¥é—¨ (5 åˆ†é’Ÿæ•™ç¨‹)

### 1.1 ç¬¬ä¸€æ¬¡ä½¿ç”¨ Claude Code

**æ­¥éª¤ 1: éªŒè¯å®‰è£…**

```bash
# æ£€æŸ¥ Claude Code æ˜¯å¦æ­£ç¡®å®‰è£…
claude --version

# æŸ¥çœ‹å¯ç”¨å‘½ä»¤
claude --help
```

**æ­¥éª¤ 2: åˆå§‹åŒ–é¡¹ç›®é…ç½®**

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/your/project

# å¯åŠ¨ Claude Code
claude

# åœ¨ Claude Code ä¸­æ‰§è¡Œ
/plugins  # æŸ¥çœ‹å·²å®‰è£…æ’ä»¶
/help     # æŸ¥çœ‹å¯ç”¨å‘½ä»¤
```

**æ­¥éª¤ 3: å®‰è£… Compound Engineering Plugin**

```bash
# æ–¹å¼ 1: é€šè¿‡æ’ä»¶å¸‚åœºå®‰è£… (æ¨è)
claude plugin marketplace add https://github.com/EveryInc/compound-engineering-plugin
# ç„¶ååœ¨ Claude Code ä¸­è¿è¡Œ /plugins å¹¶æœç´¢å®‰è£…

# æ–¹å¼ 2: æ‰‹åŠ¨å…‹éš†å®‰è£…
git clone https://github.com/EveryInc/compound-engineering-plugin ~/.claude/plugins/compound-engineering
```

**æ­¥éª¤ 4: éªŒè¯æ’ä»¶åŠ è½½**

åœ¨ Claude Code ä¸­:

```
ä½ å¥½! è¯·åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å·¥ä½œæµå‘½ä»¤
```

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼:

```
- /workflows:brainstorm - éœ€æ±‚æ¢ç´¢ä¸è®¾è®¡
- /workflows:plan - å®ç°è®¡åˆ’ç¼–å†™
- /workflows:work - è®¡åˆ’æ‰§è¡Œ
- /workflows:review - ä»£ç å®¡æŸ¥
- /workflows:compound - çŸ¥è¯†å¤åˆ
```

**æ­¥éª¤ 5: æ‰§è¡Œç¬¬ä¸€ä¸ªä»»åŠ¡**

```bash
# åœ¨ Claude Code ä¸­å°è¯•ç®€å•ä»»åŠ¡
è¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ª Python å‡½æ•°,è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬ n é¡¹
```

Claude ä¼š:
1. ç†è§£éœ€æ±‚
2. ç¼–å†™ä»£ç 
3. åˆ›å»ºæµ‹è¯•æ–‡ä»¶
4. éªŒè¯ç»“æœ

---

### 1.2 æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ

**5 å¤§æ ¸å¿ƒç»„ä»¶**:

| ç»„ä»¶ | å­˜å‚¨ä½ç½® | ç”¨é€” | è§¦å‘æ–¹å¼ |
|------|---------|------|---------|
| **Commands** | `~/.claude/commands/` | å¿«é€Ÿå¯æ‰§è¡Œæç¤º | `/command-name` |
| **Skills** | `~/.claude/skills/` | å·¥ä½œæµå®šä¹‰ä¸é¢†åŸŸçŸ¥è¯† | è¯­ä¹‰åŒ¹é…æˆ– `/skill-name` |
| **Agents** | `~/.claude/agents/` | ä¸“ä¸šåŒ–å­ä»£ç† | é€šè¿‡ Task å·¥å…·å§”æ´¾ |
| **Hooks** | `~/.claude/hooks/hooks.json` | äº‹ä»¶é©±åŠ¨è‡ªåŠ¨åŒ– | å·¥å…·è°ƒç”¨/ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ |
| **Rules** | `~/.claude/rules/` | å§‹ç»ˆéµå¾ªçš„æŒ‡å— | æ¯æ¬¡ä¼šè¯è‡ªåŠ¨åŠ è½½ |

**å·¥ä½œæµé‡‘å­—å¡”**:

```
ç”¨æˆ·æç¤º
    â†“
Commands (å¿«é€Ÿæ‰§è¡Œ) â†’ Skills (å·¥ä½œæµ) â†’ Agents (ä¸“ä¸šä»»åŠ¡)
    â†“                    â†“                 â†“
ç›´æ¥å“åº”            å¤šæ­¥éª¤æµç¨‹          åå°ç‹¬ç«‹å¤„ç†
    â†“                    â†“                 â†“
Rules (å…¨å±€çº¦æŸ) â† Hooks (è‡ªåŠ¨åŒ–) â† MCP (å¤–éƒ¨é›†æˆ)
```

---

### 1.3 ä½ çš„ç¬¬ä¸€ä¸ªå®Œæ•´å·¥ä½œæµ

**åœºæ™¯**: ä¸ºç°æœ‰ React åº”ç”¨æ·»åŠ æ–°åŠŸèƒ½

```bash
# Step 1: æ¢ç´¢éœ€æ±‚ (å¦‚æœéœ€æ±‚ä¸æ˜ç¡®)
/workflows:brainstorm æ·»åŠ ç”¨æˆ·ä¸ªäººèµ„æ–™ç¼–è¾‘åŠŸèƒ½

# Step 2: åˆ¶å®šå®ç°è®¡åˆ’
/workflows:plan åŸºäº brainstorm æ–‡æ¡£åˆ›å»ºå®ç°è®¡åˆ’

# Step 3: æ‰§è¡Œè®¡åˆ’
/workflows:work æ‰§è¡Œ plan æ–‡æ¡£ä¸­çš„ä»»åŠ¡

# Step 4: ä»£ç å®¡æŸ¥
/workflows:review å®¡æŸ¥æœ€è¿‘çš„å˜æ›´

# Step 5: çŸ¥è¯†å¤åˆ
/workflows:compound æ€»ç»“æœ¬æ¬¡å¼€å‘ä¸­çš„å­¦ä¹ è¦ç‚¹
```

**æ—¶é—´åˆ†é…å»ºè®®**:
- Brainstorm: 10-20 åˆ†é’Ÿ
- Plan: 10-15 åˆ†é’Ÿ
- Work: 30-90 åˆ†é’Ÿ
- Review: 10-15 åˆ†é’Ÿ
- Compound: 5-10 åˆ†é’Ÿ

**é¢„æœŸäº§å‡º**:
- `docs/brainstorms/2026-01-31-user-profile-edit-brainstorm.md`
- `docs/plans/2026-01-31-user-profile-edit-plan.md`
- ä»£ç å˜æ›´ + Git commits
- `todos/review-feedback.md`
- `docs/solutions/react/user-profile-patterns.md`

---

## 2. äº”å¤§çœŸå®åœºæ™¯å®æˆ˜ç¤ºä¾‹

### 2.1 åœºæ™¯ 1: ä»é›¶å¼€å§‹æ„å»º REST API

**èƒŒæ™¯**: ä½ éœ€è¦ä¸ºä¸€ä¸ªç”µå•†ç³»ç»Ÿæ„å»ºç”¨æˆ·è®¤è¯ API

**å®Œæ•´å·¥ä½œæµ (çº¦ 120 åˆ†é’Ÿ)**:

#### Phase 1: éœ€æ±‚æ¢ç´¢ (20 åˆ†é’Ÿ)

```bash
# åœ¨ Claude Code ä¸­
/workflows:brainstorm æ„å»ºç”¨æˆ·è®¤è¯ REST API,éœ€è¦æ”¯æŒ:
- ç”¨æˆ·æ³¨å†Œ (é‚®ç®± + å¯†ç )
- ç”¨æˆ·ç™»å½• (JWT token)
- å¯†ç é‡ç½®
- é‚®ç®±éªŒè¯
- ç”¨æˆ·èµ„æ–™ CRUD

æŠ€æœ¯æ ˆ: Node.js + Express + PostgreSQL + Redis (session)
```

**Brainstorm é˜¶æ®µè¾“å‡º** (`docs/brainstorms/2026-01-31-user-auth-api-brainstorm.md`):

```markdown
# User Authentication API Brainstorm

## 1. Requirements Analysis

### Functional Requirements
- User registration with email + password validation
- JWT-based authentication
- Password reset flow via email
- Email verification (6-digit code)
- User profile CRUD (GET, PUT, DELETE)

### Non-Functional Requirements
- Security: bcrypt password hashing, JWT expiration
- Rate limiting: 5 requests/min for login/register
- Session management: Redis for refresh tokens
- Database: PostgreSQL with connection pooling

## 2. API Design

### Endpoints
POST /auth/register        â†’ 201 Created + verification email
POST /auth/login           â†’ 200 OK + JWT tokens
POST /auth/refresh         â†’ 200 OK + new access token
POST /auth/forgot-password â†’ 200 OK + reset email sent
POST /auth/reset-password  â†’ 200 OK
POST /auth/verify-email    â†’ 200 OK

GET    /users/me           â†’ 200 OK + user profile
PUT    /users/me           â†’ 200 OK + updated profile
DELETE /users/me           â†’ 204 No Content

### Data Models
User {
  id: UUID (primary key)
  email: string (unique, indexed)
  password_hash: string
  is_verified: boolean
  created_at: timestamp
  updated_at: timestamp
}

VerificationCode {
  id: UUID
  user_id: UUID (foreign key)
  code: string (6 digits)
  type: enum (email_verification, password_reset)
  expires_at: timestamp
}

## 3. Security Considerations
- HTTPS only in production
- bcrypt rounds: 10
- JWT access token: 15 min expiry
- JWT refresh token: 7 days expiry
- Rate limiting via express-rate-limit
- Input validation via Joi
- SQL injection prevention via parameterized queries

## 4. Implementation Approach
1. Database schema setup
2. User registration + email verification
3. Login + JWT generation
4. Password reset flow
5. Profile CRUD
6. Integration tests

## 5. Risks & Mitigations
| Risk | Mitigation |
|------|-----------|
| Email delivery failures | Queue system (Bull/BullMQ) + retry logic |
| Token theft | Short-lived access tokens + HttpOnly cookies |
| Brute force attacks | Rate limiting + account lockout after 5 attempts |
| SQL injection | Use ORM (Prisma) or parameterized queries |
```

**å…³é”®å†³ç­–ç‚¹**:
- é€‰æ‹© JWT è€Œé session-based auth (ä¸ºæœªæ¥ API æ‰©å±•è€ƒè™‘)
- ä½¿ç”¨ Redis å­˜å‚¨ refresh tokens (æé«˜æ’¤é”€èƒ½åŠ›)
- é‚®ç®±éªŒè¯é‡‡ç”¨ 6 ä½æ•°å­—ç è€Œéé“¾æ¥ (ç”¨æˆ·ä½“éªŒæ›´å¥½)

---

#### Phase 2: å®ç°è®¡åˆ’ (15 åˆ†é’Ÿ)

```bash
/workflows:plan åŸºäº brainstorm æ–‡æ¡£åˆ›å»ºè¯¦ç»†å®ç°è®¡åˆ’
```

**Plan é˜¶æ®µè¾“å‡º** (`docs/plans/2026-01-31-user-auth-api-plan.md`):

```markdown
# User Authentication API Implementation Plan

## Overview
Implement user authentication REST API with JWT tokens, email verification, and password reset functionality.

**Estimated Time**: 4-6 hours
**Prerequisites**: PostgreSQL, Redis, Node.js 18+

---

## Task Breakdown

### Task 1: Project Setup (30 min)
**Status**: Pending

**Actions**:
1. Initialize Node.js project with TypeScript
   ```bash
   mkdir auth-api && cd auth-api
   npm init -y
   npm install express @types/express typescript ts-node
   npm install dotenv bcrypt jsonwebtoken
   npm install pg redis
   npm install -D @types/node @types/bcrypt @types/jsonwebtoken
   ```

2. Create directory structure:
   ```
   src/
     â”œâ”€â”€ config/        # Database, Redis, JWT config
     â”œâ”€â”€ models/        # User, VerificationCode models
     â”œâ”€â”€ routes/        # Auth, User routes
     â”œâ”€â”€ controllers/   # Business logic
     â”œâ”€â”€ middlewares/   # Auth, error handling, rate limiting
     â”œâ”€â”€ services/      # Email service, token service
     â”œâ”€â”€ utils/         # Validators, helpers
     â””â”€â”€ index.ts       # Entry point
   ```

3. Configure TypeScript (`tsconfig.json`)
4. Setup environment variables (`.env`)

**Verification**:
- `npm run dev` starts the server on port 3000
- Health check endpoint `/health` returns 200 OK

---

### Task 2: Database Schema (30 min)
**Status**: Pending
**Depends on**: Task 1

**Actions**:
1. Create PostgreSQL database:
   ```sql
   CREATE DATABASE auth_api;
   ```

2. Create users table:
   ```sql
   CREATE TABLE users (
     id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
     email VARCHAR(255) UNIQUE NOT NULL,
     password_hash VARCHAR(255) NOT NULL,
     is_verified BOOLEAN DEFAULT FALSE,
     created_at TIMESTAMP DEFAULT NOW(),
     updated_at TIMESTAMP DEFAULT NOW()
   );

   CREATE INDEX idx_users_email ON users(email);
   ```

3. Create verification_codes table:
   ```sql
   CREATE TABLE verification_codes (
     id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
     user_id UUID REFERENCES users(id) ON DELETE CASCADE,
     code VARCHAR(6) NOT NULL,
     type VARCHAR(50) NOT NULL,
     expires_at TIMESTAMP NOT NULL,
     created_at TIMESTAMP DEFAULT NOW()
   );

   CREATE INDEX idx_verification_codes_user_id ON verification_codes(user_id);
   CREATE INDEX idx_verification_codes_expires_at ON verification_codes(expires_at);
   ```

4. Create database migration script (`src/config/db.ts`)

**Verification**:
- Run `psql -d auth_api -c "\dt"` shows both tables
- Connection pool can execute queries

---

### Task 3: User Registration (45 min)
**Status**: Pending
**Depends on**: Task 2

**Actions**:
1. Implement `POST /auth/register` endpoint
   - Validate email format (RFC 5322)
   - Check email uniqueness
   - Hash password with bcrypt (10 rounds)
   - Insert user into database
   - Generate 6-digit verification code
   - Store code in database (10-minute expiry)
   - Send verification email (mock for now)
   - Return 201 Created

2. Implement request validator middleware (`src/middlewares/validators.ts`)
3. Implement email service (`src/services/emailService.ts`)

**Verification**:
- POST /auth/register with valid data â†’ 201 + user created
- POST /auth/register with existing email â†’ 409 Conflict
- POST /auth/register with invalid email â†’ 400 Bad Request
- Verification code stored in database with correct expiry

---

### Task 4: Email Verification (30 min)
**Status**: Pending
**Depends on**: Task 3

**Actions**:
1. Implement `POST /auth/verify-email` endpoint
   - Accept email + code
   - Validate code exists and not expired
   - Update user.is_verified = true
   - Delete verification code
   - Return 200 OK

2. Add resend verification code endpoint (optional)

**Verification**:
- POST /auth/verify-email with correct code â†’ 200 + user verified
- POST /auth/verify-email with expired code â†’ 400 Bad Request
- POST /auth/verify-email with wrong code â†’ 401 Unauthorized

---

### Task 5: User Login (45 min)
**Status**: Pending
**Depends on**: Task 4

**Actions**:
1. Implement `POST /auth/login` endpoint
   - Validate email + password
   - Check user exists
   - Verify email is confirmed
   - Compare password with bcrypt
   - Generate JWT access token (15 min expiry)
   - Generate JWT refresh token (7 days expiry)
   - Store refresh token in Redis
   - Return tokens in response body
   - Set HttpOnly cookie for refresh token

2. Implement token service (`src/services/tokenService.ts`)
3. Configure Redis connection (`src/config/redis.ts`)

**Verification**:
- POST /auth/login with valid credentials â†’ 200 + tokens
- POST /auth/login with unverified email â†’ 403 Forbidden
- POST /auth/login with wrong password â†’ 401 Unauthorized
- Refresh token stored in Redis with 7-day TTL

---

### Task 6: Token Refresh (20 min)
**Status**: Pending
**Depends on**: Task 5

**Actions**:
1. Implement `POST /auth/refresh` endpoint
   - Extract refresh token from cookie or body
   - Verify JWT signature
   - Check token exists in Redis
   - Generate new access token
   - Return new access token

**Verification**:
- POST /auth/refresh with valid token â†’ 200 + new access token
- POST /auth/refresh with revoked token â†’ 401 Unauthorized
- POST /auth/refresh with expired token â†’ 401 Unauthorized

---

### Task 7: Password Reset (45 min)
**Status**: Pending
**Depends on**: Task 5

**Actions**:
1. Implement `POST /auth/forgot-password` endpoint
   - Accept email
   - Generate 6-digit reset code
   - Store in verification_codes table (15-minute expiry)
   - Send reset email
   - Return 200 OK (even if email doesn't exist - security)

2. Implement `POST /auth/reset-password` endpoint
   - Accept email + code + new password
   - Validate code
   - Hash new password
   - Update user password_hash
   - Delete verification code
   - Revoke all user's refresh tokens from Redis
   - Return 200 OK

**Verification**:
- POST /auth/forgot-password â†’ 200 + code sent
- POST /auth/reset-password with valid code â†’ 200 + password changed
- Old tokens cannot be used after password reset

---

### Task 8: User Profile CRUD (30 min)
**Status**: Pending
**Depends on**: Task 5

**Actions**:
1. Implement auth middleware (`src/middlewares/auth.ts`)
   - Extract JWT from Authorization header
   - Verify signature
   - Attach user to request object

2. Implement `GET /users/me` (read profile)
3. Implement `PUT /users/me` (update email - requires reverification)
4. Implement `DELETE /users/me` (soft delete or hard delete)

**Verification**:
- GET /users/me without token â†’ 401 Unauthorized
- GET /users/me with valid token â†’ 200 + user data
- PUT /users/me updates email â†’ is_verified set to false
- DELETE /users/me â†’ 204 + user deleted

---

### Task 9: Rate Limiting & Security (30 min)
**Status**: Pending
**Depends on**: All above

**Actions**:
1. Implement rate limiting middleware
   - Login/Register: 5 requests/min per IP
   - Password reset: 3 requests/hour per email
   - General API: 100 requests/min per IP

2. Add helmet.js for security headers
3. Add CORS configuration
4. Add request logging (Morgan)

**Verification**:
- 6th login attempt within 1 min â†’ 429 Too Many Requests
- Security headers present in all responses
- Logs capture all requests

---

### Task 10: Integration Tests (60 min)
**Status**: Pending
**Depends on**: All above

**Actions**:
1. Setup Jest + Supertest
2. Write test suites:
   - Auth flow: register â†’ verify â†’ login â†’ refresh â†’ logout
   - Password reset flow: forgot â†’ reset â†’ login with new password
   - Profile flow: get â†’ update â†’ verify new email â†’ delete
   - Security: rate limiting, invalid tokens, SQL injection attempts

3. Setup test database

**Verification**:
- `npm test` runs all tests
- All critical paths covered
- 80%+ code coverage

---

## Dependencies Graph

```
Task 1 (Setup)
    â†“
Task 2 (Database)
    â†“
Task 3 (Register) â†’ Task 4 (Verify Email)
    â†“                        â†“
Task 5 (Login) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”œâ”€â†’ Task 6 (Refresh)
    â”œâ”€â†’ Task 7 (Password Reset)
    â””â”€â†’ Task 8 (Profile CRUD)
    â†“
Task 9 (Security)
    â†“
Task 10 (Tests)
```

---

## Success Criteria

- [ ] All endpoints respond with correct status codes
- [ ] Passwords are hashed with bcrypt
- [ ] JWTs are properly signed and verified
- [ ] Email verification prevents unverified logins
- [ ] Password reset flow works end-to-end
- [ ] Rate limiting blocks excessive requests
- [ ] Integration tests pass with 80%+ coverage
- [ ] No SQL injection vulnerabilities
- [ ] Refresh tokens can be revoked

---

## Rollout Plan

1. **Dev Environment**: Complete all tasks 1-10
2. **Staging**: Deploy with test email service (Mailtrap)
3. **Production**: Switch to SendGrid/AWS SES for emails
```

---

#### Phase 3: æ‰§è¡Œè®¡åˆ’ (60-90 åˆ†é’Ÿ)

```bash
/workflows:work æ‰§è¡Œå®ç°è®¡åˆ’
```

**Work é˜¶æ®µç‰¹ç‚¹**:
- Claude ä¼šé€ä¸ªä»»åŠ¡æ‰§è¡Œ,æ¯ä¸ªä»»åŠ¡å®Œæˆå commit
- è‡ªåŠ¨è¿è¡Œæµ‹è¯•éªŒè¯
- é‡åˆ°é—®é¢˜æ—¶æš‚åœå¹¶è¯·æ±‚æŒ‡å¯¼

**å…¸å‹æ‰§è¡Œæµç¨‹**:

```bash
# Claude çš„è‡ªåŠ¨åŒ–æ‰§è¡Œæµç¨‹

# Task 1: Project Setup
mkdir auth-api && cd auth-api
npm init -y
# ... å®‰è£…ä¾èµ–
# ... åˆ›å»ºç›®å½•ç»“æ„
git add . && git commit -m "chore: initial project setup"

# Task 2: Database Schema
# ... åˆ›å»ºæ•°æ®åº“è¡¨
# ... é…ç½®è¿æ¥æ± 
git add . && git commit -m "feat: add database schema for users and verification codes"

# Task 3: User Registration
# ... å®ç°æ³¨å†Œæ¥å£
npm test -- --testNamePattern="User Registration"
git add . && git commit -m "feat: implement user registration with email validation"

# ... ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡
```

**ä½ éœ€è¦åšçš„**:
- ç›‘æ§è¿›åº¦
- æ‰¹å‡†å…³é”®å†³ç­– (å¦‚é€‰æ‹©ç¬¬ä¸‰æ–¹åº“)
- æä¾›æµ‹è¯•åé¦ˆ
- å®¡æŸ¥ç”Ÿæˆçš„ä»£ç 

---

#### Phase 4: ä»£ç å®¡æŸ¥ (15 åˆ†é’Ÿ)

```bash
/workflows:review å®¡æŸ¥æœ€è¿‘çš„å˜æ›´
```

**Review é˜¶æ®µè¾“å‡º** (`todos/auth-api-review.md`):

```markdown
# Auth API Code Review

## Security Issues

### HIGH Priority
- [ ] **Line 45 in `src/controllers/authController.ts`**: Password comparison should use `await bcrypt.compare()`, not synchronous version
- [ ] **Line 78**: JWT secret is hardcoded - move to environment variable
- [ ] **Missing**: No input sanitization for email field (XSS vulnerability)

### MEDIUM Priority
- [ ] **Line 120**: Error messages reveal too much info (e.g., "User not found" vs "Invalid credentials")
- [ ] **Missing**: No CSRF protection for state-changing endpoints

## Code Quality

### Structure
- âœ… Good separation of concerns (controllers, services, models)
- âš ï¸  Some functions exceed 50 lines - consider refactoring `handlePasswordReset()`

### Testing
- âœ… 85% code coverage
- âš ï¸  Missing edge case: concurrent registration with same email
- âŒ No load testing for rate limiter

## Performance

- âš ï¸  Database queries in `/users/me` could be cached (Redis)
- âš ï¸  Consider connection pooling optimization (current max: 10, should be 20)

## Recommendations

1. Add integration with email service (currently mocked)
2. Implement account lockout after 5 failed login attempts
3. Add logging for security events (failed logins, password resets)
4. Document API with OpenAPI/Swagger
```

**ä¿®å¤å…³é”®é—®é¢˜**:

```bash
è¯·ä¿®å¤æ‰€æœ‰ HIGH ä¼˜å…ˆçº§çš„å®‰å…¨é—®é¢˜,ç„¶åé‡æ–°è¿è¡Œæµ‹è¯•
```

---

#### Phase 5: çŸ¥è¯†å¤åˆ (10 åˆ†é’Ÿ)

```bash
/workflows:compound æ€»ç»“ JWT è®¤è¯å®ç°çš„æœ€ä½³å®è·µ
```

**Compound é˜¶æ®µè¾“å‡º** (`docs/solutions/nodejs/jwt-auth-patterns.md`):

```markdown
# JWT Authentication Best Practices (Node.js)

## Problem Statement
Implementing secure user authentication with JWT tokens in Node.js applications.

## Solution Pattern

### 1. Token Structure
```javascript
// Access Token (short-lived)
{
  userId: "uuid",
  email: "user@example.com",
  iat: 1234567890,
  exp: 1234568790  // 15 minutes
}

// Refresh Token (long-lived)
{
  userId: "uuid",
  tokenId: "unique-id",  // for revocation
  iat: 1234567890,
  exp: 1235172690  // 7 days
}
```

### 2. Security Measures
- Store refresh tokens in Redis (easy revocation)
- Use HttpOnly cookies for refresh tokens (prevent XSS)
- Implement token rotation on refresh
- Revoke all tokens on password change
- Use short-lived access tokens (15 min)

### 3. Code Template
```typescript
// src/services/tokenService.ts
import jwt from 'jsonwebtoken';
import redis from '../config/redis';

export class TokenService {
  static generateAccessToken(userId: string): string {
    return jwt.sign(
      { userId, type: 'access' },
      process.env.JWT_SECRET!,
      { expiresIn: '15m' }
    );
  }

  static async generateRefreshToken(userId: string): Promise<string> {
    const tokenId = crypto.randomUUID();
    const token = jwt.sign(
      { userId, tokenId, type: 'refresh' },
      process.env.JWT_REFRESH_SECRET!,
      { expiresIn: '7d' }
    );

    // Store in Redis with 7-day expiry
    await redis.setex(`refresh:${userId}:${tokenId}`, 604800, token);
    return token;
  }

  static async revokeRefreshToken(userId: string, tokenId: string) {
    await redis.del(`refresh:${userId}:${tokenId}`);
  }

  static async revokeAllUserTokens(userId: string) {
    const keys = await redis.keys(`refresh:${userId}:*`);
    if (keys.length > 0) {
      await redis.del(...keys);
    }
  }
}
```

## When to Use
- User authentication in web/mobile apps
- Stateless API authentication
- Microservices authorization

## Avoid When
- Need real-time token revocation (use session-based auth)
- Tokens become very large (many claims)

## Related Patterns
- OAuth 2.0 for third-party auth
- API Key authentication for service-to-service
- Session-based auth for traditional web apps
```

---

### 2.2 åœºæ™¯ 2: ä¿®å¤ç”Ÿäº§ç¯å¢ƒ Bug (ç´§æ€¥)

**èƒŒæ™¯**: ç”Ÿäº§ç¯å¢ƒç”¨æˆ·æŠ¥å‘Šç»“è´¦æµç¨‹å¤±è´¥,é”™è¯¯ç‡ 15%

**å¿«é€Ÿä¿®å¤æµç¨‹ (çº¦ 30 åˆ†é’Ÿ)**:

#### Step 1: å¿«é€Ÿè¯Šæ–­ (5 åˆ†é’Ÿ)

```bash
# åœ¨ Claude Code ä¸­
è¯·å¸®æˆ‘åˆ†æç”Ÿäº§æ—¥å¿—,æ‰¾å‡ºç»“è´¦å¤±è´¥çš„æ ¹æœ¬åŸå› 

# é™„ä¸Šæ—¥å¿—æ–‡ä»¶
@error-logs-2026-01-31.txt
```

**Claude çš„åˆ†æ**:

```
åˆ†æç»“æœ:
1. é”™è¯¯ç±»å‹: "Cannot read property 'price' of undefined"
2. å‘ç”Ÿä½ç½®: src/services/checkoutService.ts:125
3. è§¦å‘æ¡ä»¶: å½“ç”¨æˆ·è´­ç‰©è½¦ä¸­å­˜åœ¨å·²ä¸‹æ¶å•†å“æ—¶
4. å½±å“èŒƒå›´: 15% ç”¨æˆ· (çº¦ 1200 ä¸ªæ´»è·ƒè´­ç‰©è½¦å«ä¸‹æ¶å•†å“)

æ ¹æœ¬åŸå› :
ä»£ç å‡è®¾æ‰€æœ‰è´­ç‰©è½¦å•†å“éƒ½å­˜åœ¨äºæ•°æ®åº“ä¸­,æ²¡æœ‰å¤„ç†å•†å“è¢«åˆ é™¤çš„æƒ…å†µã€‚

æ¨èä¿®å¤æ–¹æ¡ˆ:
1. ç«‹å³ä¿®å¤: è¿‡æ»¤æ‰ä¸å­˜åœ¨çš„å•†å“,å…è®¸ç»“è´¦ç»§ç»­
2. é•¿æœŸæ–¹æ¡ˆ: åœ¨å•†å“ä¸‹æ¶æ—¶æ¸…ç†æ‰€æœ‰è´­ç‰©è½¦ä¸­çš„å¼•ç”¨
```

---

#### Step 2: åº”ç”¨çƒ­ä¿®å¤ (10 åˆ†é’Ÿ)

```bash
è¯·å®ç°ç«‹å³ä¿®å¤æ–¹æ¡ˆ,å¹¶ç¡®ä¿å‘åå…¼å®¹
```

**Claude ç”Ÿæˆçš„ä¿®å¤ä»£ç **:

```typescript
// src/services/checkoutService.ts

async calculateTotal(userId: string): Promise<number> {
  const cart = await this.cartRepository.findByUserId(userId);

  // ä¿®å¤å‰:
  // const total = cart.items.reduce((sum, item) => {
  //   return sum + item.product.price * item.quantity;  // product å¯èƒ½ä¸º null!
  // }, 0);

  // ä¿®å¤å:
  const validItems = cart.items.filter(item => {
    if (!item.product) {
      logger.warn(`Product not found in cart`, {
        userId,
        cartItemId: item.id,
        productId: item.productId
      });
      return false;
    }
    return true;
  });

  // å¦‚æœæœ‰æ— æ•ˆå•†å“,ä»è´­ç‰©è½¦ä¸­ç§»é™¤
  if (validItems.length < cart.items.length) {
    await this.cleanupInvalidCartItems(userId, cart.items, validItems);
  }

  const total = validItems.reduce((sum, item) => {
    return sum + item.product!.price * item.quantity;
  }, 0);

  return total;
}

private async cleanupInvalidCartItems(
  userId: string,
  allItems: CartItem[],
  validItems: CartItem[]
) {
  const invalidItemIds = allItems
    .filter(item => !validItems.includes(item))
    .map(item => item.id);

  await this.cartRepository.removeItems(invalidItemIds);

  logger.info(`Cleaned up invalid cart items`, {
    userId,
    removedCount: invalidItemIds.length
  });
}
```

---

#### Step 3: æµ‹è¯•éªŒè¯ (10 åˆ†é’Ÿ)

```bash
è¯·ç”Ÿæˆé’ˆå¯¹æ­¤ä¿®å¤çš„æµ‹è¯•ç”¨ä¾‹,è¦†ç›–è¾¹ç¼˜æƒ…å†µ
```

**Claude ç”Ÿæˆçš„æµ‹è¯•**:

```typescript
// tests/checkoutService.test.ts

describe('CheckoutService - Invalid Product Handling', () => {
  it('should skip deleted products and calculate total correctly', async () => {
    // Setup: è´­ç‰©è½¦åŒ…å« 2 ä¸ªæœ‰æ•ˆå•†å“ + 1 ä¸ªå·²åˆ é™¤å•†å“
    const cart = {
      items: [
        { id: '1', productId: 'p1', product: { price: 10 }, quantity: 2 },
        { id: '2', productId: 'p2', product: null, quantity: 1 },  // å·²åˆ é™¤
        { id: '3', productId: 'p3', product: { price: 5 }, quantity: 3 }
      ]
    };

    const total = await checkoutService.calculateTotal('user-123');

    expect(total).toBe(35);  // (10 * 2) + (5 * 3)
    expect(cleanupSpy).toHaveBeenCalledWith('user-123', expect.anything(), expect.anything());
  });

  it('should handle cart with all products deleted', async () => {
    const cart = {
      items: [
        { id: '1', productId: 'p1', product: null, quantity: 2 },
        { id: '2', productId: 'p2', product: null, quantity: 1 }
      ]
    };

    const total = await checkoutService.calculateTotal('user-123');

    expect(total).toBe(0);
    expect(cleanupSpy).toHaveBeenCalled();
  });

  it('should log warning for each invalid product', async () => {
    // ... æµ‹è¯•æ—¥å¿—è®°å½•
  });
});
```

```bash
npm test -- checkoutService.test.ts
```

---

#### Step 4: éƒ¨ç½²ä¸ç›‘æ§ (5 åˆ†é’Ÿ)

```bash
è¯·å¸®æˆ‘åˆ›å»º hotfix åˆ†æ”¯å¹¶å‡†å¤‡éƒ¨ç½²
```

```bash
# Claude è‡ªåŠ¨æ‰§è¡Œ
git checkout -b hotfix/checkout-invalid-products
git add src/services/checkoutService.ts tests/checkoutService.test.ts
git commit -m "fix: handle deleted products in checkout flow

- Filter out null products before calculating total
- Automatically cleanup invalid cart items
- Add comprehensive test coverage for edge cases

Fixes production bug affecting 15% of checkout attempts"

git push origin hotfix/checkout-invalid-products

# åˆ›å»º PR
gh pr create --title "ğŸ”¥ Hotfix: Handle deleted products in checkout" \
  --body "Fixes critical production bug. See commit message for details." \
  --base main \
  --head hotfix/checkout-invalid-products
```

**éƒ¨ç½²åç›‘æ§**:

```bash
è¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ªç›‘æ§ dashboard,è¿½è¸ª:
1. ç»“è´¦æˆåŠŸç‡
2. è´­ç‰©è½¦æ¸…ç†äº‹ä»¶
3. ç›¸å…³é”™è¯¯æ—¥å¿—
```

---

### 2.3 åœºæ™¯ 3: é‡æ„é—ç•™ä»£ç 

**èƒŒæ™¯**: ä¸€ä¸ª 1500 è¡Œçš„ `OrderService.ts` æ–‡ä»¶éœ€è¦é‡æ„

**é‡æ„æµç¨‹ (çº¦ 90 åˆ†é’Ÿ)**:

#### Step 1: ä»£ç åˆ†æä¸è§„åˆ’ (20 åˆ†é’Ÿ)

```bash
/workflows:plan é‡æ„ src/services/OrderService.ts
ç›®æ ‡:
- æ‹†åˆ†ä¸ºå¤šä¸ªå°æ¨¡å— (æ¯ä¸ª < 200 è¡Œ)
- æé«˜å¯æµ‹è¯•æ€§
- éµå¾ªå•ä¸€èŒè´£åŸåˆ™

@src/services/OrderService.ts
```

**Plan è¾“å‡º**:

```markdown
# OrderService Refactoring Plan

## Current Issues
- 1500 lines in single file
- Multiple responsibilities mixed (validation, pricing, inventory, notifications)
- 45% code coverage (hard to test)
- Tight coupling to database (no dependency injection)

## Proposed Structure

```
src/services/order/
  â”œâ”€â”€ OrderService.ts          (150 lines) - Orchestrator
  â”œâ”€â”€ OrderValidator.ts        (100 lines) - Input validation
  â”œâ”€â”€ PricingService.ts        (200 lines) - Price calculation
  â”œâ”€â”€ InventoryService.ts      (180 lines) - Stock management
  â”œâ”€â”€ PaymentService.ts        (150 lines) - Payment processing
  â”œâ”€â”€ NotificationService.ts   (120 lines) - Email/SMS notifications
  â””â”€â”€ types.ts                 (50 lines)  - Shared types
```

## Refactoring Steps

1. Extract validation logic â†’ OrderValidator
2. Extract pricing logic â†’ PricingService
3. Extract inventory logic â†’ InventoryService
4. Extract payment logic â†’ PaymentService
5. Extract notification logic â†’ NotificationService
6. Refactor main OrderService to use extracted services
7. Add unit tests for each service (target: 90% coverage)
8. Integration tests for OrderService

## Risk Mitigation
- Use Strangler Fig pattern (gradual replacement)
- Keep old code until 100% test coverage
- Feature flag new implementation
```

---

#### Step 2: æ‰§è¡Œé‡æ„ (50 åˆ†é’Ÿ)

```bash
/workflows:work æ‰§è¡Œé‡æ„è®¡åˆ’
```

**Claude çš„æ‰§è¡Œæµç¨‹**:

```typescript
// Step 1: Extract OrderValidator
// src/services/order/OrderValidator.ts
export class OrderValidator {
  validate(orderData: CreateOrderDTO): ValidationResult {
    const errors: string[] = [];

    if (!orderData.items || orderData.items.length === 0) {
      errors.push('Order must contain at least one item');
    }

    if (!this.isValidAddress(orderData.shippingAddress)) {
      errors.push('Invalid shipping address');
    }

    // ... å…¶ä»–éªŒè¯é€»è¾‘ä»åŸæ–‡ä»¶è¿ç§»

    return { isValid: errors.length === 0, errors };
  }
}

// Step 2: Extract PricingService
// src/services/order/PricingService.ts
export class PricingService {
  calculateTotal(items: OrderItem[]): PriceBreakdown {
    const subtotal = this.calculateSubtotal(items);
    const tax = this.calculateTax(subtotal);
    const shipping = this.calculateShipping(items);
    const discount = this.applyDiscounts(items, subtotal);

    return {
      subtotal,
      tax,
      shipping,
      discount,
      total: subtotal + tax + shipping - discount
    };
  }
}

// Step 3-6: ç±»ä¼¼åœ°æå–å…¶ä»–æœåŠ¡...

// Step 7: Refactored OrderService (now 150 lines!)
// src/services/order/OrderService.ts
export class OrderService {
  constructor(
    private validator: OrderValidator,
    private pricingService: PricingService,
    private inventoryService: InventoryService,
    private paymentService: PaymentService,
    private notificationService: NotificationService,
    private orderRepository: OrderRepository
  ) {}

  async createOrder(orderData: CreateOrderDTO): Promise<Order> {
    // 1. Validate
    const validation = this.validator.validate(orderData);
    if (!validation.isValid) {
      throw new ValidationError(validation.errors);
    }

    // 2. Check inventory
    await this.inventoryService.reserveStock(orderData.items);

    try {
      // 3. Calculate pricing
      const pricing = this.pricingService.calculateTotal(orderData.items);

      // 4. Process payment
      const payment = await this.paymentService.charge({
        amount: pricing.total,
        currency: 'USD',
        customerId: orderData.customerId
      });

      // 5. Create order
      const order = await this.orderRepository.create({
        ...orderData,
        pricing,
        paymentId: payment.id,
        status: 'confirmed'
      });

      // 6. Send notifications
      await this.notificationService.sendOrderConfirmation(order);

      return order;

    } catch (error) {
      // Rollback inventory reservation
      await this.inventoryService.releaseStock(orderData.items);
      throw error;
    }
  }
}
```

**æ¯ä¸ªæå–æ­¥éª¤åéƒ½æœ‰æµ‹è¯•**:

```bash
# Claude è‡ªåŠ¨è¿è¡Œ
npm test -- OrderValidator.test.ts  # é€šè¿‡
npm test -- PricingService.test.ts  # é€šè¿‡
# ... æ¯ä¸ªæœåŠ¡éƒ½æœ‰ç‹¬ç«‹æµ‹è¯•
```

---

#### Step 3: éªŒè¯ä¸å¯¹æ¯” (20 åˆ†é’Ÿ)

```bash
/code-review å¯¹æ¯”é‡æ„å‰åçš„ä»£ç è´¨é‡
```

**Review è¾“å‡º**:

```markdown
## Refactoring Results

### Metrics Comparison

| Metric | Before | After | Change |
|--------|--------|-------|--------|
| Total lines | 1500 | 950 | -37% |
| Avg function length | 45 lines | 18 lines | -60% |
| Cyclomatic complexity | 68 | 22 | -68% |
| Test coverage | 45% | 92% | +47% |
| Files | 1 | 7 | +6 |

### Code Quality

âœ… **Improvements**:
- Each class has single responsibility
- Easy to mock dependencies for testing
- Clear separation of concerns
- Better error handling with rollbacks

âš ï¸ **Watch Out**:
- Increased number of files (need good IDE navigation)
- More complex dependency injection setup

### Performance Impact
- No performance degradation detected
- Identical behavior in integration tests
```

---

### 2.4 åœºæ™¯ 4: æ·»åŠ æ–°åŠŸèƒ½ (TDD æ–¹å¼)

**èƒŒæ™¯**: ä¸ºåšå®¢ç³»ç»Ÿæ·»åŠ "è‰ç¨¿è‡ªåŠ¨ä¿å­˜"åŠŸèƒ½

**TDD å·¥ä½œæµ (çº¦ 60 åˆ†é’Ÿ)**:

#### Step 1: éœ€æ±‚æ¾„æ¸…ä¸æµ‹è¯•è®¾è®¡ (15 åˆ†é’Ÿ)

```bash
/tdd å®ç°åšå®¢è‰ç¨¿è‡ªåŠ¨ä¿å­˜åŠŸèƒ½

éœ€æ±‚:
- æ¯éš” 30 ç§’è‡ªåŠ¨ä¿å­˜è‰ç¨¿
- ç”¨æˆ·æ‰‹åŠ¨ä¿å­˜æ—¶ç«‹å³è§¦å‘
- æ–­ç½‘æ—¶æœ¬åœ°ç¼“å­˜,æ¢å¤ååŒæ­¥
- æ˜¾ç¤º"ä¸Šæ¬¡ä¿å­˜æ—¶é—´"
```

**Claude ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹**:

```typescript
// tests/features/autosave.test.ts

describe('Blog Auto-save Feature', () => {
  describe('Periodic Auto-save', () => {
    it('should auto-save draft every 30 seconds', async () => {
      const editor = new BlogEditor();
      editor.setText('Hello world');

      // Fast-forward 30 seconds
      jest.advanceTimersByTime(30000);

      expect(saveDraftSpy).toHaveBeenCalledWith({
        content: 'Hello world',
        timestamp: expect.any(Number)
      });
    });

    it('should not save if content unchanged', async () => {
      const editor = new BlogEditor();
      editor.setText('Hello');

      jest.advanceTimersByTime(30000);
      expect(saveDraftSpy).toHaveBeenCalledTimes(1);

      // No changes, wait another 30s
      jest.advanceTimersByTime(30000);
      expect(saveDraftSpy).toHaveBeenCalledTimes(1);  // Still 1
    });

    it('should reset timer after manual save', async () => {
      const editor = new BlogEditor();
      editor.setText('Hello');

      jest.advanceTimersByTime(20000);  // 20s elapsed
      editor.manualSave();  // Manual save resets timer

      jest.advanceTimersByTime(25000);  // Wait 25s more
      expect(saveDraftSpy).toHaveBeenCalledTimes(1);  // Only manual save

      jest.advanceTimersByTime(5000);  // Now 30s since manual save
      expect(saveDraftSpy).toHaveBeenCalledTimes(2);  // Auto-save triggered
    });
  });

  describe('Offline Support', () => {
    it('should cache draft locally when offline', async () => {
      const editor = new BlogEditor();
      editor.setText('Offline content');

      // Simulate offline
      window.navigator.onLine = false;

      jest.advanceTimersByTime(30000);

      expect(localStorageSpy).toHaveBeenCalledWith(
        'draft_cache',
        expect.stringContaining('Offline content')
      );
      expect(apiSaveSpy).not.toHaveBeenCalled();
    });

    it('should sync cached drafts when coming back online', async () => {
      // Setup cached draft
      localStorage.setItem('draft_cache', JSON.stringify({
        content: 'Cached content',
        timestamp: Date.now()
      }));

      // Trigger online event
      window.dispatchEvent(new Event('online'));

      await waitFor(() => {
        expect(apiSaveSpy).toHaveBeenCalledWith({
          content: 'Cached content'
        });
      });
    });
  });

  describe('UI Indicators', () => {
    it('should display "Saving..." during save', async () => {
      const editor = new BlogEditor();
      editor.setText('Test');

      const savePromise = editor.manualSave();
      expect(editor.getStatusText()).toBe('Saving...');

      await savePromise;
      expect(editor.getStatusText()).toMatch(/Saved at \d{2}:\d{2}/);
    });

    it('should show "Failed to save" on error', async () => {
      apiSaveSpy.mockRejectedValueOnce(new Error('Network error'));

      const editor = new BlogEditor();
      editor.setText('Test');

      await editor.manualSave();

      expect(editor.getStatusText()).toBe('Failed to save. Retrying...');
    });
  });
});
```

---

#### Step 2: å®ç°åŠŸèƒ½ (30 åˆ†é’Ÿ)

```bash
ç°åœ¨è¯·å®ç°é€šè¿‡æ‰€æœ‰æµ‹è¯•çš„ä»£ç 
```

**Claude ç”Ÿæˆå®ç°**:

```typescript
// src/features/blog/BlogEditor.ts

export class BlogEditor {
  private content: string = '';
  private lastSavedContent: string = '';
  private autoSaveTimer: NodeJS.Timeout | null = null;
  private statusText: string = '';

  constructor(
    private saveService: DraftSaveService,
    private storageService: LocalStorageService
  ) {
    this.startAutoSave();
    this.setupOfflineSync();
  }

  setText(text: string) {
    this.content = text;
  }

  private startAutoSave() {
    this.autoSaveTimer = setInterval(() => {
      this.autoSave();
    }, 30000);  // 30 seconds
  }

  private async autoSave() {
    if (this.content === this.lastSavedContent) {
      return;  // No changes
    }

    await this.saveDraft();
  }

  async manualSave(): Promise<void> {
    // Reset auto-save timer
    this.resetAutoSaveTimer();
    await this.saveDraft();
  }

  private resetAutoSaveTimer() {
    if (this.autoSaveTimer) {
      clearInterval(this.autoSaveTimer);
    }
    this.startAutoSave();
  }

  private async saveDraft() {
    this.statusText = 'Saving...';

    try {
      if (navigator.onLine) {
        await this.saveService.saveDraft({
          content: this.content,
          timestamp: Date.now()
        });
        this.lastSavedContent = this.content;
        this.statusText = `Saved at ${this.formatTime(new Date())}`;
      } else {
        // Offline: cache locally
        this.storageService.set('draft_cache', {
          content: this.content,
          timestamp: Date.now()
        });
        this.statusText = 'Saved locally (offline)';
      }
    } catch (error) {
      this.statusText = 'Failed to save. Retrying...';
      // Retry after 5 seconds
      setTimeout(() => this.saveDraft(), 5000);
    }
  }

  private setupOfflineSync() {
    window.addEventListener('online', async () => {
      const cachedDraft = this.storageService.get('draft_cache');
      if (cachedDraft) {
        await this.saveService.saveDraft(cachedDraft);
        this.storageService.remove('draft_cache');
        this.statusText = 'Synced cached draft';
      }
    });
  }

  getStatusText(): string {
    return this.statusText;
  }

  private formatTime(date: Date): string {
    return date.toLocaleTimeString('en-US', {
      hour: '2-digit',
      minute: '2-digit'
    });
  }

  destroy() {
    if (this.autoSaveTimer) {
      clearInterval(this.autoSaveTimer);
    }
  }
}
```

---

#### Step 3: è¿è¡Œæµ‹è¯•å¹¶è¿­ä»£ (15 åˆ†é’Ÿ)

```bash
npm test -- autosave.test.ts
```

**æµ‹è¯•ç»“æœ**:

```
âœ“ should auto-save draft every 30 seconds
âœ“ should not save if content unchanged
âœ“ should reset timer after manual save
âœ“ should cache draft locally when offline
âœ“ should sync cached drafts when coming back online
âœ“ should display "Saving..." during save
âœ“ should show "Failed to save" on error

Test Suites: 1 passed, 1 total
Tests:       7 passed, 7 total
Coverage:    95.8% (statements)
```

---

### 2.5 åœºæ™¯ 5: æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•

**èƒŒæ™¯**: ç”¨æˆ·æŠ¥å‘Š"æœç´¢é¡µé¢åŠ è½½ç¼“æ…¢" (>5 ç§’)

**ä¼˜åŒ–æµç¨‹ (çº¦ 75 åˆ†é’Ÿ)**:

#### Step 1: æ€§èƒ½åˆ†æ (20 åˆ†é’Ÿ)

```bash
è¯·å¸®æˆ‘åˆ†ææœç´¢é¡µé¢çš„æ€§èƒ½ç“¶é¢ˆ

æŠ€æœ¯æ ˆ: Next.js + PostgreSQL + Redis
ç›¸å…³æ–‡ä»¶:
@app/search/page.tsx
@app/api/search/route.ts
@lib/searchService.ts
```

**Claude çš„åˆ†æ**:

```markdown
## Performance Analysis: Search Page

### Measurement Results (Chrome DevTools)

| Metric | Current | Target | Status |
|--------|---------|--------|--------|
| LCP (Largest Contentful Paint) | 5.2s | <2.5s | âŒ |
| FID (First Input Delay) | 180ms | <100ms | âš ï¸ |
| CLS (Cumulative Layout Shift) | 0.08 | <0.1 | âœ… |
| TTFB (Time to First Byte) | 3.8s | <600ms | âŒ |

### Identified Bottlenecks

#### 1. Database Query (3.2s) - CRITICAL
```sql
-- Current query in searchService.ts:45
SELECT * FROM products
WHERE title ILIKE '%keyword%' OR description ILIKE '%keyword%'
ORDER BY created_at DESC
LIMIT 20;
```

**Issues**:
- No indexes on `title` and `description` columns
- `ILIKE '%keyword%'` prevents index usage
- Fetching all columns (`SELECT *`)
- No query result caching

#### 2. N+1 Query Problem (1.5s) - HIGH
```typescript
// app/api/search/route.ts:32
const products = await searchProducts(query);

// For each product, fetching reviews separately!
for (const product of products) {
  product.reviews = await getReviews(product.id);  // N+1!
}
```

#### 3. Client-Side Rendering (800ms) - MEDIUM
- 20 product cards rendering synchronously
- Large images not optimized (avg 500KB each)
- No virtualization for long lists

### Recommendations (Priority Order)

1. Add full-text search index (PostgreSQL `tsvector`)
2. Fix N+1 query with single JOIN
3. Implement Redis caching (5-minute TTL)
4. Optimize images (Next.js Image component)
5. Add pagination/infinite scroll
```

---

#### Step 2: å®æ–½ä¼˜åŒ– (40 åˆ†é’Ÿ)

```bash
è¯·æŒ‰ä¼˜å…ˆçº§å®æ–½æ‰€æœ‰ä¼˜åŒ–å»ºè®®
```

**ä¼˜åŒ– 1: æ•°æ®åº“ç´¢å¼•ä¸å…¨æ–‡æœç´¢**

```sql
-- migrations/add_search_indexes.sql

-- Add tsvector column for full-text search
ALTER TABLE products
ADD COLUMN search_vector tsvector;

-- Create GIN index
CREATE INDEX idx_products_search
ON products USING GIN(search_vector);

-- Populate search_vector
UPDATE products
SET search_vector =
  setweight(to_tsvector('english', coalesce(title, '')), 'A') ||
  setweight(to_tsvector('english', coalesce(description, '')), 'B');

-- Trigger to keep search_vector updated
CREATE TRIGGER tsvector_update
BEFORE INSERT OR UPDATE ON products
FOR EACH ROW EXECUTE FUNCTION
  tsvector_update_trigger(search_vector, 'pg_catalog.english', title, description);
```

```typescript
// lib/searchService.ts - Refactored

async searchProducts(query: string): Promise<Product[]> {
  // New: Full-text search with tsvector
  const result = await db.query(`
    SELECT
      id,
      title,
      price,
      image_url,
      ts_rank(search_vector, plainto_tsquery('english', $1)) as rank
    FROM products
    WHERE search_vector @@ plainto_tsquery('english', $1)
    ORDER BY rank DESC, created_at DESC
    LIMIT 20
  `, [query]);

  return result.rows;
}
```

**Performance Impact**: 3.2s â†’ 180ms (94% reduction)

---

**ä¼˜åŒ– 2: ä¿®å¤ N+1 æŸ¥è¯¢**

```typescript
// app/api/search/route.ts - Before
const products = await searchProducts(query);
for (const product of products) {
  product.reviews = await getReviews(product.id);  // N+1!
}

// app/api/search/route.ts - After
const products = await searchProductsWithReviews(query);

// lib/searchService.ts - New function
async searchProductsWithReviews(query: string): Promise<Product[]> {
  const result = await db.query(`
    SELECT
      p.id,
      p.title,
      p.price,
      p.image_url,
      COALESCE(
        json_agg(
          json_build_object(
            'id', r.id,
            'rating', r.rating,
            'comment', r.comment
          )
        ) FILTER (WHERE r.id IS NOT NULL),
        '[]'
      ) as reviews
    FROM products p
    LEFT JOIN reviews r ON r.product_id = p.id
    WHERE p.search_vector @@ plainto_tsquery('english', $1)
    GROUP BY p.id
    ORDER BY ts_rank(p.search_vector, plainto_tsquery('english', $1)) DESC
    LIMIT 20
  `, [query]);

  return result.rows;
}
```

**Performance Impact**: 1.5s â†’ 0ms (eliminated)

---

**ä¼˜åŒ– 3: Redis ç¼“å­˜**

```typescript
// lib/searchService.ts - With caching

async searchProductsWithReviews(query: string): Promise<Product[]> {
  const cacheKey = `search:${query}`;

  // Check cache first
  const cached = await redis.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }

  // Cache miss: query database
  const result = await db.query(/* ... */);
  const products = result.rows;

  // Cache for 5 minutes
  await redis.setex(cacheKey, 300, JSON.stringify(products));

  return products;
}
```

**Performance Impact**: 180ms â†’ 15ms (for cached results)

---

**ä¼˜åŒ– 4: å›¾ç‰‡ä¼˜åŒ–**

```tsx
// app/search/page.tsx - Before
<img src={product.imageUrl} alt={product.title} />

// app/search/page.tsx - After
import Image from 'next/image';

<Image
  src={product.imageUrl}
  alt={product.title}
  width={300}
  height={300}
  quality={75}
  loading="lazy"
  placeholder="blur"
  blurDataURL="/placeholder.jpg"
/>
```

**Performance Impact**: 500KB â†’ 50KB per image (90% reduction)

---

#### Step 3: éªŒè¯ä¼˜åŒ–æ•ˆæœ (15 åˆ†é’Ÿ)

```bash
/verify è¿è¡Œæ€§èƒ½æµ‹è¯•,å¯¹æ¯”ä¼˜åŒ–å‰å
```

**æµ‹è¯•ç»“æœ**:

```markdown
## Performance Test Results

### Core Web Vitals

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| LCP | 5.2s | 1.8s | âœ… 65% faster |
| FID | 180ms | 45ms | âœ… 75% faster |
| CLS | 0.08 | 0.05 | âœ… 38% better |
| TTFB | 3.8s | 250ms | âœ… 93% faster |

### Load Test (100 concurrent users)

| Metric | Before | After |
|--------|--------|-------|
| Avg response time | 4.2s | 320ms |
| 95th percentile | 8.1s | 580ms |
| Error rate | 2.3% | 0% |
| Throughput | 24 req/s | 312 req/s |

### Database Query Performance

```sql
-- Before
Seq Scan on products  (cost=0.00..15234.00 rows=50000 width=500)
Filter: ((title ~~* '%laptop%') OR (description ~~* '%laptop%'))
Planning Time: 2.3 ms
Execution Time: 3245.6 ms

-- After
Bitmap Heap Scan on products  (cost=24.50..185.30 rows=50 width=120)
  Recheck Cond: (search_vector @@ plainto_tsquery('english', 'laptop'))
  ->  Bitmap Index Scan on idx_products_search  (cost=0.00..24.49)
Planning Time: 0.5 ms
Execution Time: 12.8 ms
```

âœ… All optimizations verified successfully!
```

---

## 3. å·¥ä½œæµä¸ä»£ç†é€‰æ‹©æŒ‡å—

### 3.1 å·¥ä½œæµå†³ç­–æ ‘

```
å¼€å§‹æ–°ä»»åŠ¡
    â†“
éœ€æ±‚æ˜¯å¦æ˜ç¡®?
    â”œâ”€ å¦ â†’ /workflows:brainstorm
    â”‚           â†“
    â”‚      éœ€æ±‚å·²æ˜ç¡®
    â””â”€ æ˜¯ â†’ ç»§ç»­
         â†“
æ˜¯å¦æœ‰å®ç°è®¡åˆ’?
    â”œâ”€ å¦ â†’ /workflows:plan
    â”‚           â†“
    â”‚      è®¡åˆ’å·²æ‰¹å‡†
    â””â”€ æ˜¯ â†’ /workflows:work
                â†“
           ä»£ç å·²å®Œæˆ
                â†“
           /workflows:review
                â†“
           ä¿®å¤é—®é¢˜ (if any)
                â†“
           /workflows:compound
                â†“
           å®Œæˆ âœ“
```

---

### 3.2 å‘½ä»¤é€‰æ‹©é€ŸæŸ¥è¡¨

| åœºæ™¯ | æ¨èå‘½ä»¤ | æ›¿ä»£æ–¹æ¡ˆ | é¢„è®¡æ—¶é—´ |
|------|---------|---------|---------|
| **æ¢ç´¢æ–°åŠŸèƒ½** | `/workflows:brainstorm` | ç›´æ¥å¯¹è¯ | 10-20 min |
| **åˆ¶å®šå®ç°è®¡åˆ’** | `/workflows:plan` | `/plan` | 10-15 min |
| **æ‰§è¡Œè®¡åˆ’** | `/workflows:work` | æ‰‹åŠ¨ç¼–ç  | 30-90 min |
| **ä»£ç å®¡æŸ¥** | `/workflows:review` | `/code-review` | 10-15 min |
| **çŸ¥è¯†æ²‰æ·€** | `/workflows:compound` | `/learn` | 5-10 min |
| **TDD å¼€å‘** | `/tdd` | æ‰‹åŠ¨å†™æµ‹è¯• | 20-60 min |
| **E2E æµ‹è¯•** | `/e2e` | æ‰‹åŠ¨å†™ Playwright | 30-45 min |
| **ä¿®å¤æ„å»ºé”™è¯¯** | `/build-fix` | æ‰‹åŠ¨è°ƒè¯• | 5-20 min |
| **é‡æ„æ¸…ç†** | `/refactor-clean` | æ‰‹åŠ¨æ¸…ç† | 10-30 min |
| **æ›´æ–°æ–‡æ¡£** | `/update-docs` | æ‰‹åŠ¨ç¼–å†™ | 15-30 min |
| **æµ‹è¯•è¦†ç›–ç‡** | `/test-coverage` | `npm run coverage` | 5-10 min |
| **æ€§èƒ½åˆ†æ** | å¯¹è¯ + `/verify` | Chrome DevTools | 20-40 min |
| **å®‰å…¨å®¡æŸ¥** | `/security-review` | æ‰‹åŠ¨æ£€æŸ¥ | 15-25 min |

---

### 3.3 ä»£ç†é€‰æ‹©çŸ©é˜µ

#### ä½•æ—¶ä½¿ç”¨ä»£ç† vs ç›´æ¥å¯¹è¯?

| ä»»åŠ¡ç±»å‹ | ä½¿ç”¨ä»£ç† | ç›´æ¥å¯¹è¯ |
|---------|---------|---------|
| **ç ”ç©¶å¯†é›†å‹** (éœ€è¦é˜…è¯»å¤§é‡æ–‡æ¡£) | âœ… `repo-research-analyst` | âŒ æµªè´¹ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡ |
| **ä¸“ä¸šå®¡æŸ¥** (ä»£ç ã€å®‰å…¨ã€æ€§èƒ½) | âœ… `code-reviewer`, `security-reviewer` | âŒ ç¼ºå°‘ä¸“ä¸šè§†è§’ |
| **é•¿æ—¶é—´è¿è¡Œ** (E2E æµ‹è¯•ã€æ„å»ºä¿®å¤) | âœ… `e2e-runner`, `build-error-resolver` | âŒ é˜»å¡ä¸»ä¼šè¯ |
| **ç®€å•é—®ç­”** (è¯­æ³•ã€æ¦‚å¿µ) | âŒ è¿‡åº¦è®¾è®¡ | âœ… å¿«é€Ÿå“åº” |
| **å¿«é€Ÿç¼–ç ** (< 50 è¡Œä»£ç ) | âŒ é¢å¤–å¼€é”€ | âœ… ç›´æ¥é«˜æ•ˆ |

---

#### ä»£ç†èŒè´£é€ŸæŸ¥

| ä»£ç†åç§° | æ ¸å¿ƒèŒè´£ | è¾“å…¥ | è¾“å‡º | å…¸å‹æ—¶é•¿ |
|---------|---------|------|------|---------|
| **planner** | å®ç°è®¡åˆ’ç¼–å†™ | éœ€æ±‚æ–‡æ¡£ | `docs/plans/*.md` | 10-15 min |
| **architect** | ç³»ç»Ÿè®¾è®¡å†³ç­– | æ¶æ„é—®é¢˜ | è®¾è®¡æ–‡æ¡£ | 15-30 min |
| **tdd-guide** | TDD å·¥ä½œæµ | åŠŸèƒ½éœ€æ±‚ | æµ‹è¯• + å®ç° | 20-60 min |
| **code-reviewer** | è´¨é‡ä¸å®‰å…¨å®¡æŸ¥ | Git diff | `todos/*.md` | 10-15 min |
| **security-reviewer** | æ¼æ´åˆ†æ | ä»£ç æ–‡ä»¶ | å®‰å…¨æŠ¥å‘Š | 15-25 min |
| **build-error-resolver** | ä¿®å¤æ„å»ºé”™è¯¯ | é”™è¯¯æ—¥å¿— | ä¿®å¤ä»£ç  | 5-20 min |
| **e2e-runner** | E2E æµ‹è¯•ç”Ÿæˆ | ç”¨æˆ·æµç¨‹ | Playwright æµ‹è¯• | 30-45 min |
| **refactor-cleaner** | æ­»ä»£ç æ¸…ç† | é¡¹ç›®è·¯å¾„ | æ¸…ç† PR | 10-30 min |
| **doc-updater** | æ–‡æ¡£åŒæ­¥ | ä»£ç å˜æ›´ | æ›´æ–°æ–‡æ¡£ | 15-30 min |
| **repo-research-analyst** | æ–‡æ¡£ç ”ç©¶ | ç ”ç©¶é—®é¢˜ | æ€»ç»“æŠ¥å‘Š | 10-20 min |
| **database-reviewer** | æ•°æ®åº“å®¡æŸ¥ | Schema/Query | ä¼˜åŒ–å»ºè®® | 15-25 min |

---

### 3.4 æŠ€èƒ½æ¿€æ´»ç­–ç•¥

#### è‡ªåŠ¨æ¿€æ´» vs æ‰‹åŠ¨è°ƒç”¨

**è‡ªåŠ¨æ¿€æ´»åœºæ™¯** (é€šè¿‡è¯­ä¹‰åŒ¹é…):

```bash
# ç”¨æˆ·è¯´: "æˆ‘æƒ³éµå¾ª TDD æµç¨‹å¼€å‘ç™»å½•åŠŸèƒ½"
# â†’ è‡ªåŠ¨æ¿€æ´»: tdd-workflow skill

# ç”¨æˆ·è¯´: "å¸®æˆ‘å®¡æŸ¥è¿™æ®µä»£ç çš„å®‰å…¨æ€§"
# â†’ è‡ªåŠ¨æ¿€æ´»: security-review skill

# ç”¨æˆ·è¯´: "å¦‚ä½•åœ¨ Next.js ä¸­å®ç° SSR?"
# â†’ è‡ªåŠ¨æ¿€æ´»: frontend-patterns skill
```

**æ‰‹åŠ¨è°ƒç”¨åœºæ™¯**:

```bash
# æ˜ç¡®éœ€è¦ç‰¹å®šå·¥ä½œæµ
/tdd å®ç°ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½

# å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šæŠ€èƒ½
/security-review @src/auth/

# é“¾å¼è°ƒç”¨
/plan && /workflows:work
```

---

### 3.5 å¹¶è¡ŒåŒ–ç­–ç•¥

#### ä½•æ—¶ä½¿ç”¨å¹¶è¡Œä»£ç†?

**é€‚åˆå¹¶è¡Œçš„ä»»åŠ¡** (Git Worktrees æ¨¡å¼):

```bash
# åœºæ™¯: åŒæ—¶å¼€å‘ 3 ä¸ªç‹¬ç«‹åŠŸèƒ½

# Worktree 1: ç”¨æˆ·è®¤è¯
git worktree add ../auth-feature feature/auth
cd ../auth-feature
claude  # å¯åŠ¨ä»£ç† 1
> /workflows:work å®ç°ç”¨æˆ·è®¤è¯

# Worktree 2: æ”¯ä»˜é›†æˆ
git worktree add ../payment-feature feature/payment
cd ../payment-feature
claude  # å¯åŠ¨ä»£ç† 2
> /workflows:work é›†æˆ Stripe æ”¯ä»˜

# Worktree 3: é‚®ä»¶é€šçŸ¥
git worktree add ../email-feature feature/email
cd ../email-feature
claude  # å¯åŠ¨ä»£ç† 3
> /workflows:work å®ç°é‚®ä»¶æœåŠ¡
```

**å¹¶è¡Œé€‚ç”¨æ¡ä»¶**:
- âœ… ä»»åŠ¡ä¹‹é—´æ— ä¾èµ–
- âœ… ä¿®æ”¹ä¸åŒçš„æ–‡ä»¶
- âœ… æ¯ä¸ªä»»åŠ¡é¢„è®¡ > 30 åˆ†é’Ÿ
- âœ… ä½ æœ‰è¶³å¤Ÿçš„ API é…é¢

**é¿å…å¹¶è¡Œçš„æƒ…å†µ**:
- âŒ ä»»åŠ¡æœ‰ä¾èµ–å…³ç³»
- âŒ ä¿®æ”¹ç›¸åŒæ–‡ä»¶ (åˆå¹¶å†²çª)
- âŒ çŸ­ä»»åŠ¡ (< 15 åˆ†é’Ÿ,å¼€é”€ä¸å€¼å¾—)
- âŒ API é™æµé£é™©

---

## 4. å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

### 4.1 ä¸Šä¸‹æ–‡ç®¡ç†é”™è¯¯

#### é”™è¯¯ 1: ä¸Šä¸‹æ–‡æº¢å‡ºå¯¼è‡´æ€§èƒ½ä¸‹é™

**ç—‡çŠ¶**:
- Claude å“åº”å˜æ…¢ (> 30 ç§’)
- é‡å¤ä¹‹å‰çš„å»ºè®®
- "I apologize, I don't have enough context..."

**åŸå› **:
- 200k token çª—å£è¢«å¡«æ»¡
- è¿‡å¤š MCP å·¥å…·å ç”¨ä¸Šä¸‹æ–‡ (æ¯ä¸ª ~500 tokens)
- å¤§æ–‡ä»¶è¢«å¤šæ¬¡è¯»å–

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. æ£€æŸ¥ä¸Šä¸‹æ–‡ä½¿ç”¨æƒ…å†µ
# åœ¨ Claude Code ä¸­
è¯·å‘Šè¯‰æˆ‘å½“å‰ä¸Šä¸‹æ–‡ä½¿ç”¨æƒ…å†µ

# 2. ç¦ç”¨æœªä½¿ç”¨çš„ MCP
/plugins
# å¯¼èˆªåˆ° MCP åˆ—è¡¨,ç¦ç”¨ä¸éœ€è¦çš„

# 3. æˆ˜ç•¥æ€§å‹ç¼©
/checkpoint  # ä¿å­˜å½“å‰çŠ¶æ€
# ç„¶åæ‰‹åŠ¨æ¸…ç†ä¸Šä¸‹æ–‡ (Cmd/Ctrl + Shift + P â†’ "Clear Conversation")

# 4. ä½¿ç”¨å­ä»£ç†åˆ†æ‹…å·¥ä½œ
Task tdd-guide("å®ç°ç™»å½•åŠŸèƒ½")  # åœ¨ç‹¬ç«‹ä¸Šä¸‹æ–‡ä¸­è¿è¡Œ
```

**é¢„é˜²æªæ–½**:
- ä¿æŒ < 10 ä¸ª MCP å¯ç”¨
- å¤§å‹é‡æ„ä½¿ç”¨å¤šä¸ªå°ä¼šè¯
- å®šæœŸä½¿ç”¨ `/checkpoint`

---

#### é”™è¯¯ 2: è¿‡åº¦ä¾èµ– `@` æ–‡ä»¶å¼•ç”¨

**ç—‡çŠ¶**:
- æ¯æ¬¡éƒ½éœ€è¦ `@file.ts` æ‰èƒ½å·¥ä½œ
- Claude å¿˜è®°ä¹‹å‰è®¨è®ºçš„ä»£ç 

**åŸå› **:
- æ–‡ä»¶é€šè¿‡å·¥å…·è¯»å–,ä¼˜å…ˆçº§ä½äºç³»ç»Ÿæç¤º
- å¤§æ–‡ä»¶è¯»å–æµªè´¹ token

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ–¹å¼ 1: ä½¿ç”¨ Rules å›ºåŒ–é‡è¦æ¨¡å¼
# ~/.claude/rules/project-patterns.md
## Project-Specific Patterns

### Authentication Flow
All auth endpoints must:
- Use bcrypt for password hashing
- Return JWT tokens with 15-min expiry
- Log security events to `logs/security.log`

### Database Queries
- Always use parameterized queries (Prisma)
- Add indexes for frequently queried columns
- Use `SELECT` specific columns, not `SELECT *`

# æ–¹å¼ 2: åˆ›å»ºé¡¹ç›® Skill
# ~/.claude/skills/my-project-guidelines/SKILL.md
(åŒ…å«é¡¹ç›®ç‰¹å®šçš„æ¶æ„ã€æ¨¡å¼ã€çº¦å®š)

# æ–¹å¼ 3: åŠ¨æ€ç³»ç»Ÿæç¤º (é«˜çº§)
claude --system-prompt "$(cat .claude/contexts/dev.md)"
```

---

### 4.2 å·¥ä½œæµæ‰§è¡Œé”™è¯¯

#### é”™è¯¯ 3: è·³è¿‡ Brainstorm/Plan é˜¶æ®µ

**ç—‡çŠ¶**:
- ä»£ç é¢‘ç¹æ¨å€’é‡æ¥
- "è¿™ä¸æ˜¯æˆ‘æƒ³è¦çš„"
- éœ€æ±‚ç†è§£åå·®

**åŸå› **:
- ç›´æ¥æ‰§è¡Œæ¨¡ç³Šéœ€æ±‚
- Claude åŸºäºå‡è®¾å®ç°

**è§£å†³æ–¹æ¡ˆ**:

```bash
# âŒ é”™è¯¯åšæ³•
å¸®æˆ‘å®ç°ä¸€ä¸ªç”¨æˆ·ç³»ç»Ÿ

# âœ… æ­£ç¡®åšæ³•
/workflows:brainstorm ç”¨æˆ·ç³»ç»Ÿéœ€è¦æ”¯æŒ:
- è§’è‰²æƒé™ (admin, user, guest)
- ç¤¾äº¤ç™»å½• (Google, GitHub)
- åŒå› ç´ è®¤è¯

(ç­‰å¾… brainstorm å®Œæˆå¹¶å®¡æŸ¥)

/workflows:plan åŸºäº brainstorm æ–‡æ¡£

(å®¡æŸ¥è®¡åˆ’,ç¡®è®¤æŠ€æœ¯é€‰å‹)

/workflows:work æ‰§è¡Œè®¡åˆ’
```

**ç»éªŒæ³•åˆ™**:
- ç®€å•ä»»åŠ¡ (< 50 è¡Œä»£ç ): å¯è·³è¿‡ brainstorm
- ä¸­ç­‰ä»»åŠ¡ (50-200 è¡Œ): è‡³å°‘éœ€è¦ plan
- å¤æ‚ä»»åŠ¡ (> 200 è¡Œ): å¿…é¡» brainstorm + plan

---

#### é”™è¯¯ 4: å¿½ç•¥ä»£ç†çš„é™åˆ¶

**ç—‡çŠ¶**:
- ä»£ç†è¿”å›"æˆ‘æ— æ³•è®¿é—® X"
- ä»£ç†è¶Šæƒæ‰§è¡Œä¸åº”è¯¥åšçš„æ“ä½œ

**åŸå› **:
- ä»£ç†æœ‰å·¥å…·æƒé™é™åˆ¶
- æ²¡æœ‰é…ç½®æ­£ç¡®çš„ MCP/Skills

**è§£å†³æ–¹æ¡ˆ**:

```markdown
# ~/.claude/agents/code-reviewer.md é…ç½®ç¤ºä¾‹

# Code Reviewer Agent

## Allowed Tools
- Read (æ–‡ä»¶è¯»å–)
- Grep (ä»£ç æœç´¢)
- Bash (è¿è¡Œ linters)

## Prohibited Tools
- Write (ä¸èƒ½ç›´æ¥ä¿®æ”¹ä»£ç )
- Edit (ä¸èƒ½ç¼–è¾‘æ–‡ä»¶)
- Git (ä¸èƒ½æäº¤ä»£ç )

## Allowed Skills
- security-review
- coding-standards

## Role
Review code for quality, security, and adherence to standards.
Provide actionable feedback in todos/*.md files.
```

**é…ç½®ä»£ç†æƒé™**:

```bash
# åœ¨å§”æ´¾ä»»åŠ¡æ—¶æ˜ç¡®é™åˆ¶
Task code-reviewer("å®¡æŸ¥ auth æ¨¡å—", {
  allowedTools: ["Read", "Grep"],
  allowedPaths: ["src/auth/**"],
  outputPath: "todos/auth-review.md"
})
```

---

### 4.3 æµ‹è¯•ä¸éªŒè¯é”™è¯¯

#### é”™è¯¯ 5: æµ‹è¯•è¦†ç›–ç‡ä¸è¶³

**ç—‡çŠ¶**:
- ç”Ÿäº§ç¯å¢ƒå‘ç° bug
- å›å½’é—®é¢˜é¢‘ç¹

**åŸå› **:
- æ²¡æœ‰ä½¿ç”¨ TDD å·¥ä½œæµ
- åªå†™äº†å¿«ä¹è·¯å¾„æµ‹è¯•

**è§£å†³æ–¹æ¡ˆ**:

```bash
# ä½¿ç”¨ /tdd å‘½ä»¤å¼ºåˆ¶æµ‹è¯•ä¼˜å…ˆ
/tdd å®ç°æ”¯ä»˜å¤„ç†åŠŸèƒ½

# Claude ä¼šç”Ÿæˆ:
# 1. æµ‹è¯•ç”¨ä¾‹ (åŒ…æ‹¬è¾¹ç¼˜æƒ…å†µ)
# 2. å®ç°ä»£ç 
# 3. è¿è¡Œæµ‹è¯•éªŒè¯
# 4. ä»£ç è¦†ç›–ç‡æŠ¥å‘Š

# æ£€æŸ¥è¦†ç›–ç‡
/test-coverage

# å¦‚æœè¦†ç›–ç‡ < 80%, è¡¥å……æµ‹è¯•
è¯·ä¸º paymentService è¡¥å……ä»¥ä¸‹åœºæ™¯çš„æµ‹è¯•:
- æ”¯ä»˜è¶…æ—¶
- ç½‘ç»œé”™è¯¯
- é‡å¤æ”¯ä»˜
```

---

#### é”™è¯¯ 6: å¿˜è®°é›†æˆæµ‹è¯•

**ç—‡çŠ¶**:
- å•å…ƒæµ‹è¯•é€šè¿‡,ä½†åŠŸèƒ½ä¸å·¥ä½œ
- ç»„ä»¶é›†æˆé—®é¢˜

**åŸå› **:
- åªä¾èµ–å•å…ƒæµ‹è¯•
- Mock è¦†ç›–äº†çœŸå®é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:

```bash
# ç”Ÿæˆ E2E æµ‹è¯•
/e2e ç”¨æˆ·è´­ä¹°æµç¨‹:
1. ç™»å½•
2. æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
3. ç»“è´¦
4. éªŒè¯è®¢å•ç¡®è®¤é‚®ä»¶

# Claude ç”Ÿæˆ Playwright æµ‹è¯•
# tests/e2e/checkout-flow.spec.ts

# è¿è¡Œ E2E æµ‹è¯•
npm run test:e2e
```

**æµ‹è¯•é‡‘å­—å¡”å»ºè®®**:
- 70% å•å…ƒæµ‹è¯• (å¿«é€Ÿ, éš”ç¦»)
- 20% é›†æˆæµ‹è¯• (ç»„ä»¶åä½œ)
- 10% E2E æµ‹è¯• (ç”¨æˆ·æµç¨‹)

---

### 4.4 æ€§èƒ½ä¸èµ„æºé”™è¯¯

#### é”™è¯¯ 7: MCP è¿‡è½½

**ç—‡çŠ¶**:
- Claude å¯åŠ¨ç¼“æ…¢ (> 10 ç§’)
- 200k ä¸Šä¸‹æ–‡åªå‰© 70k å¯ç”¨
- é¢‘ç¹è¶…æ—¶

**åŸå› **:
- å¯ç”¨äº† 20+ ä¸ª MCP æœåŠ¡å™¨
- æ¯ä¸ª MCP åŠ è½½å¤§é‡å·¥å…·

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. å®¡æŸ¥ MCP ä½¿ç”¨æƒ…å†µ
/mcp

# 2. ç¦ç”¨ä¸å¸¸ç”¨çš„ MCP
# Settings â†’ Plugins â†’ æ‰¾åˆ° MCP â†’ Disable

# 3. ä½¿ç”¨é¡¹ç›®çº§ MCP é…ç½®
# .claude/mcp-config.json
{
  "enabledServers": [
    "github",      # ä»…ä¸ºæ­¤é¡¹ç›®å¯ç”¨
    "postgresql"
  ]
}

# 4. æŒ‰éœ€å¯ç”¨
# éœ€è¦ Supabase æ—¶æ‰å¯ç”¨è¯¥ MCP
/plugins enable supabase
(ä½¿ç”¨å)
/plugins disable supabase
```

**æœ€ä½³å®è·µ**:
- ç”¨æˆ·çº§: é…ç½®æ‰€æœ‰ MCP,ä½†ç¦ç”¨å¤§éƒ¨åˆ†
- é¡¹ç›®çº§: åªå¯ç”¨å¿…éœ€çš„ MCP
- ä¼šè¯çº§: ä¸´æ—¶å¯ç”¨ç‰¹å®š MCP

---

#### é”™è¯¯ 8: API é™æµ

**ç—‡çŠ¶**:
- "Rate limit exceeded" é”™è¯¯
- Claude è¯·æ±‚è¢«æ‹’ç»

**åŸå› **:
- çŸ­æ—¶é—´å†…å¤§é‡ API è°ƒç”¨
- å¤šä¸ªå¹¶è¡Œä»£ç†åŒæ—¶è¿è¡Œ

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. ä½¿ç”¨åå°ä»»åŠ¡é¿å…é˜»å¡
Task e2e-runner("ç”Ÿæˆæ‰€æœ‰æµ‹è¯•", { background: true })
# æ”¶åˆ°é€šçŸ¥åæŸ¥çœ‹ç»“æœ

# 2. æ‰¹é‡æ“ä½œè€Œéé€ä¸ª
# âŒ é”™è¯¯
è¯·ä¸ºæ¯ä¸ªæ–‡ä»¶ç”Ÿæˆæµ‹è¯•
(Claude é€ä¸ªå¤„ç†,è§¦å‘é™æµ)

# âœ… æ­£ç¡®
è¯·ä¸º src/services/ ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æ‰¹é‡ç”Ÿæˆæµ‹è¯•
(Claude ä¸€æ¬¡æ€§å¤„ç†)

# 3. ä½¿ç”¨æ›´å°çš„æ¨¡å‹å¤„ç†ç®€å•ä»»åŠ¡
# ~/.claude/rules/performance.md
For simple tasks (linting, formatting), prefer Claude Haiku.
For complex tasks (architecture, debugging), use Claude Opus.

# 4. é”™å³°ä½¿ç”¨
# é¿å…åœ¨é«˜å³°æœŸ (US å·¥ä½œæ—¶é—´) è¿è¡Œå¤§å‹ä»»åŠ¡
```

---

### 4.5 åä½œä¸ç‰ˆæœ¬æ§åˆ¶é”™è¯¯

#### é”™è¯¯ 9: Git æäº¤æ··ä¹±

**ç—‡çŠ¶**:
- å·¨å¤§çš„å•æ¬¡æäº¤ (500+ è¡Œ)
- æäº¤ä¿¡æ¯ä¸æ¸…æ™°
- éš¾ä»¥å›æ»š

**åŸå› **:
- æ²¡æœ‰ä½¿ç”¨å¢é‡æäº¤å·¥ä½œæµ
- Claude ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**:

```bash
# ä½¿ç”¨ /workflows:work è‡ªåŠ¨å¢é‡æäº¤
/workflows:work æ‰§è¡Œè®¡åˆ’
# Claude ä¼šåœ¨æ¯ä¸ªä»»åŠ¡å®Œæˆåæäº¤

# æˆ–è€…æ˜ç¡®è¦æ±‚
è¯·å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½,æ¯å®Œæˆä¸€ä¸ªå­åŠŸèƒ½å°±æäº¤ä¸€æ¬¡:
1. æ•°æ®åº“ schema â†’ commit
2. æ³¨å†Œæ¥å£ â†’ commit
3. ç™»å½•æ¥å£ â†’ commit
4. æµ‹è¯• â†’ commit

# é…ç½® Git è§„åˆ™
# ~/.claude/rules/git-workflow.md
## Commit Guidelines
- One logical change per commit
- Follow Conventional Commits (feat:, fix:, chore:, etc.)
- Max 50 chars in subject line
- Include Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**Git Hooks è¾…åŠ©**:

```json
// ~/.claude/hooks/hooks.json
{
  "PreToolUse": [{
    "matcher": "tool == 'Bash' && tool_input.command matches 'git commit'",
    "hooks": [{
      "type": "command",
      "command": "node scripts/validate-commit-message.js"
    }]
  }]
}
```

---

#### é”™è¯¯ 10: åˆå¹¶å†²çªé¢‘ç¹

**ç—‡çŠ¶**:
- å¤šäººåä½œæ—¶é¢‘ç¹å†²çª
- å¹¶è¡Œä»£ç†äº§ç”Ÿå†²çª

**åŸå› **:
- å¤šä¸ªä»£ç†ä¿®æ”¹ç›¸åŒæ–‡ä»¶
- æ²¡æœ‰ä½¿ç”¨ Git Worktrees

**è§£å†³æ–¹æ¡ˆ**:

```bash
# ä½¿ç”¨ Git Worktrees éš”ç¦»å·¥ä½œ
git worktree add ../feature-a feature/a
git worktree add ../feature-b feature/b

# åœ¨ä¸åŒç›®å½•å¯åŠ¨ Claude
cd ../feature-a && claude  # ä»£ç† 1
cd ../feature-b && claude  # ä»£ç† 2

# å®ŒæˆåæŒ‰é¡ºåºåˆå¹¶
git checkout main
git merge feature/a
git merge feature/b  # å†²çªå°‘å¾—å¤š

# æˆ–ä½¿ç”¨ /orchestrate å‘½ä»¤åè°ƒ
/orchestrate å¹¶è¡Œå¼€å‘åŠŸèƒ½ A å’Œ B,ç¡®ä¿æ— å†²çª
```

---

## 5. æ•ˆç‡æå‡çš„ 10 æ¡é»„é‡‘æ³•åˆ™

### æ³•åˆ™ 1: 20% æ—¶é—´è§„åˆ’, 80% æ—¶é—´æ‰§è¡Œ

**Why**: å……åˆ†è§„åˆ’å‡å°‘è¿”å·¥,æ€»ä½“æ›´å¿«

**How**:

```bash
# âŒ ä½æ•ˆåšæ³•
å¸®æˆ‘æ„å»ºä¸€ä¸ªç”µå•†ç½‘ç«™
(6 å°æ—¶åå‘ç°æ¶æ„éœ€è¦é‡æ„)

# âœ… é«˜æ•ˆåšæ³•
/workflows:brainstorm ç”µå•†ç½‘ç«™ MVP  # 20 åˆ†é’Ÿ
/workflows:plan åŸºäº brainstorm      # 15 åˆ†é’Ÿ
/workflows:work æ‰§è¡Œè®¡åˆ’              # 3 å°æ—¶
(æ€»è€—æ—¶: 3.5 å°æ—¶,è´¨é‡æ›´é«˜)
```

**Metric**: è§„åˆ’é˜¶æ®µæŠ•å…¥ 20% æ—¶é—´,è¿”å·¥ç‡é™ä½ 60%

---

### æ³•åˆ™ 2: ä¼˜å…ˆä½¿ç”¨æŠ€èƒ½,è€Œéé‡å¤æç¤º

**Why**: æŠ€èƒ½å¯å¤ç”¨,é¿å…æ¯æ¬¡é‡æ–°è§£é‡Š

**How**:

```bash
# åœºæ™¯: æ¯æ¬¡ä»£ç å®¡æŸ¥éƒ½è¦æ±‚ç›¸åŒçš„æ£€æŸ¥é¡¹

# âŒ ä½æ•ˆ (æ¯æ¬¡æ‰‹åŠ¨åˆ—ä¸¾)
è¯·å®¡æŸ¥è¿™æ®µä»£ç :
- æ£€æŸ¥å®‰å…¨æ¼æ´
- éªŒè¯é”™è¯¯å¤„ç†
- è¯„ä¼°æ€§èƒ½
- ...

# âœ… é«˜æ•ˆ (åˆ›å»ºæŠ€èƒ½)
# ~/.claude/skills/code-review-checklist/SKILL.md
## Code Review Checklist
(è¯¦ç»†çš„æ£€æŸ¥æ¸…å•)

# ä½¿ç”¨æ—¶:
/code-review @src/auth.ts
```

**Metric**: åˆ›å»º 5 ä¸ªæ ¸å¿ƒæŠ€èƒ½,èŠ‚çœ 40% æç¤ºç¼–å†™æ—¶é—´

---

### æ³•åˆ™ 3: å­ä»£ç†å¤„ç†é•¿æ—¶é—´ä»»åŠ¡

**Why**: é‡Šæ”¾ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡,é¿å…é˜»å¡

**How**:

```bash
# âŒ ä¸»çº¿ç¨‹é˜»å¡
è¯·ç”Ÿæˆæ‰€æœ‰ API çš„ E2E æµ‹è¯•
(ç­‰å¾… 45 åˆ†é’Ÿ,æ— æ³•åšå…¶ä»–äº‹)

# âœ… å­ä»£ç†åå°å¤„ç†
Task e2e-runner("ç”Ÿæˆæ‰€æœ‰ API çš„ E2E æµ‹è¯•", { background: true })
# ç«‹å³ç»§ç»­å…¶ä»–å·¥ä½œ
(45 åˆ†é’Ÿåæ”¶åˆ°é€šçŸ¥,æŸ¥çœ‹ç»“æœ)
```

**Metric**: å¹¶è¡Œæ•ˆç‡æå‡ 3-5 å€

---

### æ³•åˆ™ 4: æˆ˜ç•¥æ€§ä½¿ç”¨ä¸Šä¸‹æ–‡å‹ç¼©

**Why**: é¿å…æ€§èƒ½ä¸‹é™,ä¿æŒå“åº”é€Ÿåº¦

**How**:

```bash
# åœ¨ä»¥ä¸‹æ—¶æœºå‹ç¼©:
# 1. å®Œæˆé‡å¤§é˜¶æ®µå
/workflows:work å®Œæˆ  # å·¥ä½œå®Œæˆ
/checkpoint            # ä¿å­˜çŠ¶æ€
(æ¸…ç†ä¸Šä¸‹æ–‡,å¼€å§‹ review é˜¶æ®µ)

# 2. ä¸Šä¸‹æ–‡ä½¿ç”¨ > 70% æ—¶
# 3. Claude å“åº”å˜æ…¢æ—¶

# ä½¿ç”¨é’©å­è‡ªåŠ¨æé†’
# hooks.json - PreCompact hook
{
  "PreCompact": [{
    "hooks": [{
      "type": "command",
      "command": "node scripts/save-session-state.js"
    }]
  }]
}
```

**Metric**: ä¿æŒä¸Šä¸‹æ–‡ < 150k tokens,å“åº”é€Ÿåº¦å¿« 2-3 å€

---

### æ³•åˆ™ 5: MCP æœ€å°åŒ–åŸåˆ™

**Why**: æ¯ä¸ª MCP å ç”¨ä¸Šä¸‹æ–‡,å½±å“æ€§èƒ½

**How**:

```bash
# ç»éªŒæ³•åˆ™
- å…¨å±€å¯ç”¨: 3-5 ä¸ª (GitHub, Filesystem, Browser)
- é¡¹ç›®å¯ç”¨: 2-3 ä¸ª (PostgreSQL, Redis, etc.)
- æ€»è®¡æ´»è·ƒ: < 10 ä¸ª MCP

# å®šæœŸå®¡è®¡
/mcp
(ç¦ç”¨ 3 ä¸ªæœˆæœªä½¿ç”¨çš„ MCP)
```

**Metric**: MCP < 10 ä¸ª,å¯ç”¨ä¸Šä¸‹æ–‡æå‡ 40%

---

### æ³•åˆ™ 6: æµ‹è¯•é©±åŠ¨å¼€å‘ (TDD) æé«˜è´¨é‡

**Why**: å…ˆå†™æµ‹è¯•,ç¡®ä¿æ­£ç¡®æ€§,å‡å°‘ debug æ—¶é—´

**How**:

```bash
# æ‰€æœ‰æ–°åŠŸèƒ½ä½¿ç”¨ /tdd
/tdd å®ç°å¯†ç é‡ç½®åŠŸèƒ½

# Claude å·¥ä½œæµ:
# 1. ç¼–å†™æµ‹è¯•ç”¨ä¾‹ (åŒ…æ‹¬è¾¹ç¼˜æƒ…å†µ)
# 2. å®ç°åŠŸèƒ½
# 3. è¿è¡Œæµ‹è¯•
# 4. ä¿®å¤å¤±è´¥æµ‹è¯•
# 5. é‡æ„ä¼˜åŒ–
# 6. æœ€ç»ˆéªŒè¯
```

**Metric**: TDD é¡¹ç›® bug ç‡é™ä½ 50%, debug æ—¶é—´å‡å°‘ 60%

---

### æ³•åˆ™ 7: çŸ¥è¯†å¤åˆ - è®©æ¯æ¬¡å·¥ä½œæ›´å®¹æ˜“

**Why**: æ²‰æ·€ç»éªŒ,é¿å…é‡å¤è§£å†³ç›¸åŒé—®é¢˜

**How**:

```bash
# æ¯æ¬¡è§£å†³éå¹³å‡¡é—®é¢˜å
/workflows:compound æ€»ç»“ JWT è®¤è¯æœ€ä½³å®è·µ

# è¾“å‡ºä¿å­˜åˆ° docs/solutions/
# ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜,è‡ªåŠ¨å¼•ç”¨

# ä½¿ç”¨æŒç»­å­¦ä¹ æŠ€èƒ½
# Stop hook è‡ªåŠ¨æå–ä¼šè¯ä¸­çš„å­¦ä¹ 
```

**Metric**: 6 ä¸ªæœˆå,80% é—®é¢˜å·²æœ‰è§£å†³æ–¹æ¡ˆæ¨¡æ¿

---

### æ³•åˆ™ 8: æ‰¹é‡æ“ä½œè€Œéé€ä¸ªå¤„ç†

**Why**: å‡å°‘ API è°ƒç”¨,é¿å…é™æµ

**How**:

```bash
# âŒ ä½æ•ˆ
è¯·ä¸º userService.ts ç”Ÿæˆæµ‹è¯•
è¯·ä¸º authService.ts ç”Ÿæˆæµ‹è¯•
è¯·ä¸º paymentService.ts ç”Ÿæˆæµ‹è¯•
(3 æ¬¡è¯·æ±‚)

# âœ… é«˜æ•ˆ
è¯·ä¸º src/services/ ç›®å½•ä¸‹æ‰€æœ‰ *Service.ts æ–‡ä»¶æ‰¹é‡ç”Ÿæˆæµ‹è¯•
(1 æ¬¡è¯·æ±‚)
```

**Metric**: API è°ƒç”¨å‡å°‘ 70%, å®Œæˆæ—¶é—´ç¼©çŸ­ 50%

---

### æ³•åˆ™ 9: ä½¿ç”¨ Git Worktrees å¹¶è¡Œå¼€å‘

**Why**: å¤šä¸ªåŠŸèƒ½å¹¶è¡Œ,ä¸äº’ç›¸é˜»å¡

**How**:

```bash
# åˆ›å»º worktrees
git worktree add ../auth feature/auth
git worktree add ../payment feature/payment

# å¹¶è¡Œå¼€å‘
cd ../auth && claude      # ç»ˆç«¯ 1
cd ../payment && claude   # ç»ˆç«¯ 2

# æŒ‰é¡ºåºåˆå¹¶
git checkout main
git merge feature/auth
git merge feature/payment
```

**Metric**: å¼€å‘å‘¨æœŸç¼©çŸ­ 40%, åˆå¹¶å†²çªå‡å°‘ 80%

---

### æ³•åˆ™ 10: å®šæœŸå®¡æŸ¥ä¸ä¼˜åŒ–å·¥ä½œæµ

**Why**: æŒç»­æ”¹è¿›,é€‚åº”é¡¹ç›®å˜åŒ–

**How**:

```bash
# æ¯æœˆå®¡æŸ¥
1. å“ªäº›æŠ€èƒ½/å‘½ä»¤ä½¿ç”¨é¢‘ç¹? (ä¼˜åŒ–å®ƒä»¬)
2. å“ªäº›æŠ€èƒ½ä»æœªä½¿ç”¨? (åˆ é™¤æˆ–åˆå¹¶)
3. å“ªäº›é‡å¤æç¤ºå‡ºç° > 5 æ¬¡? (åˆ›å»ºæ–°æŠ€èƒ½)
4. å“ªäº›ä»£ç†ä»»åŠ¡å¤±è´¥ç‡é«˜? (æ”¹è¿›é…ç½®)

# åˆ›å»ºå®¡æŸ¥æŠ€èƒ½
/workflows:compound æ€»ç»“æœ¬æœˆå·¥ä½œæµæ”¹è¿›ç‚¹
```

**Metric**: æ¯æœˆä¼˜åŒ–å,æ•ˆç‡æå‡ 10-15%

---

## 6. å¸¸è§é—®é¢˜è§£ç­” (FAQ)

### Q1: Claude Code vs GitHub Copilot - å¦‚ä½•é€‰æ‹©?

**A**: ä¸¤è€…å®šä½ä¸åŒ,å¯äº’è¡¥ä½¿ç”¨

| ç»´åº¦ | Claude Code | GitHub Copilot |
|------|-------------|---------------|
| **æ ¸å¿ƒä¼˜åŠ¿** | æ¶æ„è®¾è®¡ã€é‡æ„ã€å¤æ‚é—®é¢˜ | ä»£ç è¡¥å…¨ã€æ ·æ¿ä»£ç  |
| **å·¥ä½œæ–¹å¼** | å¯¹è¯å¼ã€å·¥ä½œæµé©±åŠ¨ | å†…è”å»ºè®®ã€è‡ªåŠ¨è¡¥å…¨ |
| **é€‚ç”¨åœºæ™¯** | æ–°åŠŸèƒ½å¼€å‘ã€Bug ä¿®å¤ã€ä»£ç å®¡æŸ¥ | å¿«é€Ÿç¼–ç ã€é‡å¤ä»£ç  |
| **ä¸Šä¸‹æ–‡ç†è§£** | æ•´ä¸ªé¡¹ç›® (200k tokens) | å½“å‰æ–‡ä»¶ + è¿‘æœŸæ–‡ä»¶ |
| **æˆæœ¬** | æŒ‰ API ç”¨é‡ | å›ºå®šæœˆè´¹ ($10-19) |

**æ¨èç»„åˆ**:
- æ—¥å¸¸ç¼–ç : GitHub Copilot (å¿«é€Ÿè¡¥å…¨)
- å¤æ‚ä»»åŠ¡: Claude Code (æ¶æ„ã€é‡æ„)
- ä»£ç å®¡æŸ¥: Claude Code (æ›´å…¨é¢)

---

### Q2: å¦‚ä½•æ§åˆ¶ Claude Code çš„æˆæœ¬?

**A**: å¤šå±‚ç­–ç•¥é™ä½æˆæœ¬

**ç­–ç•¥ 1: æ¨¡å‹é€‰æ‹©**

```bash
# ~/.claude/rules/performance.md
## Model Selection Guidelines

Use **Claude Haiku** (æœ€ä¾¿å®œ) for:
- Linting and formatting
- Simple refactoring (rename, extract)
- Running tests
- Git commit messages

Use **Claude Sonnet** (ä¸­ç­‰) for:
- Feature implementation
- Bug fixing
- Code reviews
- Documentation

Use **Claude Opus** (æœ€è´µ) for:
- System architecture design
- Complex debugging
- Security reviews
- Performance optimization
```

**ç­–ç•¥ 2: å‡å°‘ Token ä½¿ç”¨**

```bash
# 1. ä½¿ç”¨æŠ€èƒ½è€Œéé•¿æç¤º
# âŒ æ¯æ¬¡ 500 tokens
# âœ… æŠ€èƒ½å¼•ç”¨ 50 tokens

# 2. æˆ˜ç•¥æ€§æ–‡ä»¶å¼•ç”¨
# âŒ @large-file.ts (5000 tokens)
# âœ… åªå¼•ç”¨ç›¸å…³å‡½æ•° (500 tokens)

# 3. ä½¿ç”¨å­ä»£ç†
# ä¸»çº¿ç¨‹æˆæœ¬é™ä½ 60%
```

**ç­–ç•¥ 3: ç¼“å­˜ä¼˜åŒ–**

```bash
# å¯ç”¨ prompt caching (Anthropic)
# System prompt ç¼“å­˜å¯èŠ‚çœ 90% tokens
```

**æˆæœ¬ä¼°ç®—**:
- è½»åº¦ä½¿ç”¨ (10 å°æ—¶/æœˆ): $20-40
- ä¸­åº¦ä½¿ç”¨ (40 å°æ—¶/æœˆ): $80-150
- é‡åº¦ä½¿ç”¨ (160 å°æ—¶/æœˆ): $300-500

---

### Q3: å¤šäººå›¢é˜Ÿå¦‚ä½•å…±äº« Claude Code é…ç½®?

**A**: åˆ†å±‚é…ç½®ç­–ç•¥

**å±‚çº§ 1: é¡¹ç›®çº§é…ç½®** (Git ç®¡ç†)

```bash
# é¡¹ç›®æ ¹ç›®å½•
.claude/
  â”œâ”€â”€ rules/              # å›¢é˜Ÿç¼–ç è§„èŒƒ
  â”‚   â”œâ”€â”€ coding-style.md
  â”‚   â”œâ”€â”€ security.md
  â”‚   â””â”€â”€ testing.md
  â”œâ”€â”€ skills/             # é¡¹ç›®ç‰¹å®šæŠ€èƒ½
  â”‚   â””â”€â”€ project-guidelines/
  â”œâ”€â”€ agents/             # è‡ªå®šä¹‰ä»£ç†
  â”œâ”€â”€ CLAUDE.md           # é¡¹ç›®è¯´æ˜
  â””â”€â”€ mcp-config.json     # é¡¹ç›® MCP é…ç½®

# æ‰€æœ‰å›¢é˜Ÿæˆå‘˜ clone åè‡ªåŠ¨è·å¾—
```

**å±‚çº§ 2: å›¢é˜Ÿæ¨¡æ¿** (GitHub Template Repository)

```bash
# åˆ›å»ºå›¢é˜Ÿæ¨¡æ¿ä»“åº“
company/claude-config-template/
  â””â”€â”€ (åŒ…å«é€šç”¨é…ç½®)

# æ–°é¡¹ç›®ä½¿ç”¨
gh repo create new-project --template company/claude-config-template
```

**å±‚çº§ 3: ä¸ªäººçº§é…ç½®** (æœ¬åœ°ä¸æäº¤)

```bash
# ~/.claude/ (ä¸ªäººåå¥½)
~/.claude/
  â”œâ”€â”€ commands/      # ä¸ªäººå¿«æ·å‘½ä»¤
  â”œâ”€â”€ skills/        # ä¸ªäººæŠ€èƒ½åº“
  â””â”€â”€ rules/         # ä¸ªäººè§„èŒƒ (ä¸é¡¹ç›®åˆå¹¶)
```

**åŒæ­¥ç­–ç•¥**:

```bash
# é¡¹ç›®é…ç½®æ›´æ–°
git pull origin main  # è‡ªåŠ¨è·å–æœ€æ–°é…ç½®

# å›¢é˜Ÿå…±è¯†ä¿®æ”¹
# é€šè¿‡ PR æµç¨‹æ›´æ–° .claude/ é…ç½®
```

---

### Q4: Claude Code èƒ½å¦ç¦»çº¿ä½¿ç”¨?

**A**: éƒ¨åˆ†åŠŸèƒ½å¯ç¦»çº¿,æ ¸å¿ƒåŠŸèƒ½éœ€è”ç½‘

**å¯ç¦»çº¿**:
- âœ… è¯»å–æœ¬åœ°æŠ€èƒ½/è§„åˆ™/ä»£ç†é…ç½®
- âœ… æ–‡ä»¶æ“ä½œ (Read, Write, Edit)
- âœ… Bash å‘½ä»¤æ‰§è¡Œ
- âœ… Git æ“ä½œ

**éœ€è”ç½‘**:
- âŒ Claude AI æ¨¡å‹æ¨ç† (æ ¸å¿ƒ)
- âŒ MCP æœåŠ¡å™¨é€šä¿¡
- âŒ æ’ä»¶å¸‚åœºè®¿é—®
- âŒ WebSearch åŠŸèƒ½

**é™çº§æ–¹æ¡ˆ**:
1. ä½¿ç”¨æœ¬åœ° LLM (éœ€è‡ªè¡Œé…ç½® API endpoint)
2. å‡†å¤‡ç¦»çº¿æŠ€èƒ½åº“ (é¢„å…ˆä¸‹è½½)
3. ç¦»çº¿æ—¶ä½¿ç”¨ä¼ ç»Ÿ IDE (å®Œæˆåè”ç½‘åŒæ­¥)

---

### Q5: å¦‚ä½•å¤„ç†æ•æ„Ÿä¿¡æ¯ (API Keys, Secrets)?

**A**: å¤šå±‚é˜²æŠ¤ç­–ç•¥

**ç­–ç•¥ 1: ç¯å¢ƒå˜é‡ + .env**

```bash
# .env (æ°¸è¿œä¸è¦æäº¤!)
DATABASE_URL=postgresql://...
STRIPE_SECRET_KEY=sk_test_...

# .gitignore
.env
.env.local
*.key
*.pem

# Claude Code è§„åˆ™
# ~/.claude/rules/security.md
## Security Rules
- NEVER commit .env files
- NEVER hardcode API keys
- ALWAYS use environment variables
- VERIFY .gitignore before first commit
```

**ç­–ç•¥ 2: Git Hooks é˜²æŠ¤**

```json
// hooks.json
{
  "PreToolUse": [{
    "matcher": "tool == 'Bash' && tool_input.command matches 'git commit'",
    "hooks": [{
      "type": "command",
      "command": "node scripts/check-secrets.js"  // æ£€æŸ¥æ•æ„Ÿä¿¡æ¯
    }]
  }]
}
```

**ç­–ç•¥ 3: Claude ä¸»åŠ¨æ£€æµ‹**

```bash
# åœ¨æäº¤å‰è¯¢é—®
è¯·æ£€æŸ¥è¿™æ¬¡æäº¤æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯ (API keys, passwords, tokens)

# Claude ä¼šæ‰«æ git diff
```

**ç´§æ€¥å“åº”**:

```bash
# å¦‚æœä¸å°å¿ƒæäº¤äº† secrets
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch .env" \
  --prune-empty --tag-name-filter cat -- --all

# ç„¶åç«‹å³è½®æ¢æ³„éœ²çš„å¯†é’¥!
```

---

### Q6: Claude Code æ”¯æŒå“ªäº›ç¼–ç¨‹è¯­è¨€?

**A**: ç†è®ºä¸Šæ”¯æŒæ‰€æœ‰è¯­è¨€,å®é™…æ•ˆæœæœ‰å·®å¼‚

**Tier 1 (ä¼˜ç§€æ”¯æŒ)**:
- JavaScript/TypeScript (Node.js, React, Next.js)
- Python (Django, FastAPI, Flask)
- Go
- Rust
- Java/Kotlin

**Tier 2 (è‰¯å¥½æ”¯æŒ)**:
- C/C++
- C#/.NET
- Ruby (Rails)
- PHP (Laravel)
- Swift (iOS)

**Tier 3 (åŸºç¡€æ”¯æŒ)**:
- Scala
- Elixir
- Haskell
- OCaml

**é™åˆ¶**:
- ä¸“æœ‰/å°ä¼—è¯­è¨€: æ•ˆæœæœ‰é™
- Legacy ä»£ç : å¯èƒ½éœ€è¦æ›´å¤šä¸Šä¸‹æ–‡

**æå‡æ•ˆæœ**:
1. åˆ›å»ºè¯­è¨€ç‰¹å®šæŠ€èƒ½
2. æä¾›ä»£ç é£æ ¼ç¤ºä¾‹
3. å¼•ç”¨å®˜æ–¹æ–‡æ¡£

---

### Q7: å¦‚ä½•åœ¨ CI/CD ä¸­é›†æˆ Claude Code?

**A**: é€šè¿‡ API é›†æˆ (éœ€ç¼–ç¨‹)

**åœºæ™¯ 1: è‡ªåŠ¨ä»£ç å®¡æŸ¥**

```yaml
# .github/workflows/claude-review.yml
name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Run Claude Code Review
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          # ä½¿ç”¨ Anthropic API
          node scripts/claude-review.js ${{ github.event.pull_request.number }}
```

**åœºæ™¯ 2: è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•**

```yaml
# .github/workflows/auto-tests.yml
on:
  push:
    paths:
      - 'src/**/*.ts'

jobs:
  generate-tests:
    runs-on: ubuntu-latest
    steps:
      - name: Generate Tests for Changed Files
        run: |
          node scripts/generate-tests.js
          git add tests/
          git commit -m "chore: auto-generated tests"
```

**æ³¨æ„äº‹é¡¹**:
- API æˆæœ¬æ§åˆ¶ (è®¾ç½® budget limit)
- å®¡æŸ¥ AI ç”Ÿæˆå†…å®¹ (ä¸è¦ç›²ç›®åˆå¹¶)
- é€Ÿç‡é™åˆ¶å¤„ç†

---

### Q8: Claude Code èƒ½å¦è®¿é—®ç§æœ‰ä»“åº“/å†…ç½‘æœåŠ¡?

**A**: å¯ä»¥,ä½†éœ€é…ç½®

**åœºæ™¯ 1: ç§æœ‰ GitHub ä»“åº“**

```bash
# ä½¿ç”¨ GitHub MCP é…ç½®ä¸ªäººè®¿é—®ä»¤ç‰Œ
# ~/.claude/mcp-servers.json
{
  "github": {
    "command": "mcp-github",
    "env": {
      "GITHUB_TOKEN": "ghp_your_personal_access_token"
    }
  }
}

# æƒé™èŒƒå›´
# - repo (è®¿é—®ç§æœ‰ä»“åº“)
# - read:org (è¯»å–ç»„ç»‡ä¿¡æ¯)
```

**åœºæ™¯ 2: å†…ç½‘ API/æ•°æ®åº“**

```bash
# æ–¹å¼ 1: VPN è¿æ¥
# Claude Code é€šè¿‡ä½ çš„æœ¬åœ°ç½‘ç»œè®¿é—®

# æ–¹å¼ 2: è‡ªå®šä¹‰ MCP æœåŠ¡å™¨
# mcp-servers/internal-api.js
export default {
  async callInternalAPI(endpoint) {
    const response = await fetch(`http://internal.company.com/api${endpoint}`, {
      headers: {
        'Authorization': `Bearer ${process.env.INTERNAL_API_TOKEN}`
      }
    });
    return response.json();
  }
}
```

**å®‰å…¨å»ºè®®**:
- ä½¿ç”¨æœ€å°æƒé™ä»¤ç‰Œ
- å®šæœŸè½®æ¢å‡­è¯
- å®¡è®¡ MCP è®¿é—®æ—¥å¿—

---

### Q9: å¦‚ä½•å¤„ç†å¤§å‹é¡¹ç›® (> 100k è¡Œä»£ç )?

**A**: åˆ†è€Œæ²»ä¹‹ç­–ç•¥

**ç­–ç•¥ 1: æ¨¡å—åŒ–æŠ€èƒ½**

```bash
# ä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»ºç‹¬ç«‹æŠ€èƒ½
~/.claude/skills/
  â”œâ”€â”€ auth-module/        # è®¤è¯æ¨¡å—è§„èŒƒ
  â”œâ”€â”€ payment-module/     # æ”¯ä»˜æ¨¡å—è§„èŒƒ
  â”œâ”€â”€ notification-module/
  â””â”€â”€ ...

# å·¥ä½œæ—¶åªæ¿€æ´»ç›¸å…³æŠ€èƒ½
/workflows:work ä¿®å¤æ”¯ä»˜æ¨¡å— Bug  # åªæ¿€æ´» payment-module skill
```

**ç­–ç•¥ 2: Codemaps å¯¼èˆª**

```bash
# ç”Ÿæˆé¡¹ç›®ä»£ç åœ°å›¾
/update-codemaps

# è¾“å‡º: .claude/codemaps/
#   - architecture.md    (é«˜å±‚æ¶æ„)
#   - modules.md         (æ¨¡å—ä¾èµ–)
#   - hotspots.md        (é¢‘ç¹ä¿®æ”¹æ–‡ä»¶)

# Claude ä½¿ç”¨ codemaps å¿«é€Ÿå®šä½
```

**ç­–ç•¥ 3: åˆ†å±‚ä¸Šä¸‹æ–‡**

```bash
# éœ€æ±‚ â†’ æ¨¡å— â†’ æ–‡ä»¶
è¯·ä¿®å¤ç”¨æˆ·ç™»å½• Bug
  â†’ Claude: å®šä½åˆ° auth æ¨¡å—
    â†’ è¯»å– auth/login.ts
      â†’ åªåŠ è½½ç›¸å…³ä¾èµ–

# é¿å…åŠ è½½æ•´ä¸ªé¡¹ç›®
```

**ç­–ç•¥ 4: è¿­ä»£æ£€ç´¢æ¨¡å¼**

```bash
# ä½¿ç”¨ iterative-retrieval skill
# é€æ­¥ç¼©å°èŒƒå›´
1. æœç´¢ç›¸å…³æ¨¡å— (Grep)
2. è¯»å–æ ¸å¿ƒæ–‡ä»¶
3. æ ¹æ®éœ€è¦æ‰©å±•ä¸Šä¸‹æ–‡
```

---

### Q10: Claude Code ä¸ IDE æ’ä»¶å¦‚ä½•é…åˆ?

**A**: äº’è¡¥ä½¿ç”¨,å‘æŒ¥å„è‡ªä¼˜åŠ¿

**åˆ†å·¥å»ºè®®**:

| ä»»åŠ¡ç±»å‹ | IDE æ’ä»¶ (Cursor, Continue) | Claude Code CLI |
|---------|---------------------------|-----------------|
| **å®æ—¶è¡¥å…¨** | âœ… æ›´å¿«,æ›´æµç•… | âŒ éœ€æ‰‹åŠ¨è¯·æ±‚ |
| **å¤æ‚é‡æ„** | âš ï¸ å—é™äº IDE è§†å›¾ | âœ… å…¨å±€è§†è§’ |
| **å¤šæ–‡ä»¶æ“ä½œ** | âš ï¸ æ‰‹åŠ¨åè°ƒ | âœ… è‡ªåŠ¨åŒ–å·¥ä½œæµ |
| **ä»£ç å®¡æŸ¥** | âŒ åŠŸèƒ½æœ‰é™ | âœ… å…¨é¢æ·±å…¥ |
| **æ¶æ„è®¾è®¡** | âŒ ä¸é€‚åˆ | âœ… å¯¹è¯å¼æ¢ç´¢ |
| **Git æ“ä½œ** | âš ï¸ åŸºç¡€åŠŸèƒ½ | âœ… å¢é‡æäº¤å·¥ä½œæµ |

**æœ€ä½³å®è·µ**:

```bash
# æ—¥å¸¸ç¼–ç 
IDE (Cursor):
- å‡½æ•°è¡¥å…¨
- å˜é‡é‡å‘½å
- ç®€å•é‡æ„

# å¤æ‚ä»»åŠ¡
Claude Code CLI:
- æ–°åŠŸèƒ½å¼€å‘ (/workflows:brainstorm â†’ plan â†’ work)
- è·¨æ¨¡å—é‡æ„
- æ€§èƒ½ä¼˜åŒ–
- å®‰å…¨å®¡æŸ¥

# ç»„åˆå·¥ä½œæµ
1. Cursor å¿«é€Ÿå®ç°åŠŸèƒ½
2. Claude Code å®¡æŸ¥ä¼˜åŒ– (/code-review)
3. Claude Code ç”Ÿæˆæµ‹è¯• (/tdd)
4. Cursor å¾®è°ƒç»†èŠ‚
```

**æŠ€èƒ½å…±äº«**:

```bash
# ~/.claude/skills/ å¯è¢«ä¸¤è€…å…±äº«
# IDE æ’ä»¶ä¹Ÿä¼šè¯»å– .claude/rules/
```

---

## æ€»ç»“

æœ¬æŒ‡å—æ¶µç›–äº† Claude Code çš„æœ€ä½³å®è·µ,ä»å¿«é€Ÿå…¥é—¨åˆ°é«˜çº§ä¼˜åŒ–:

1. **å¿«é€Ÿå…¥é—¨**: 5 åˆ†é’Ÿä¸Šæ‰‹æ ¸å¿ƒå·¥ä½œæµ
2. **å®æˆ˜ç¤ºä¾‹**: 5 ä¸ªçœŸå®åœºæ™¯çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ
3. **å†³ç­–æŒ‡å—**: å·¥ä½œæµã€ä»£ç†ã€æŠ€èƒ½é€‰æ‹©çŸ©é˜µ
4. **é”™è¯¯é¿å…**: 10 å¤§å¸¸è§é™·é˜±åŠè§£å†³æ–¹æ¡ˆ
5. **æ•ˆç‡æ³•åˆ™**: 10 æ¡é»„é‡‘è§„åˆ™æŒç»­æå‡ç”Ÿäº§åŠ›
6. **FAQ**: 10 ä¸ªæœ€å¸¸è§é—®é¢˜çš„æ·±åº¦è§£ç­”

**å…³é”®è¦ç‚¹å›é¡¾**:

- âœ… éµå¾ª 80/20 åŸåˆ™: 20% è§„åˆ’, 80% æ‰§è¡Œ
- âœ… æŠ€èƒ½ > é‡å¤æç¤º (DRY åŸåˆ™)
- âœ… å­ä»£ç†å¤„ç†é•¿ä»»åŠ¡ (å¹¶è¡Œæ€ç»´)
- âœ… æˆ˜ç•¥æ€§å‹ç¼©ä¸Šä¸‹æ–‡ (ä¿æŒæ€§èƒ½)
- âœ… MCP æœ€å°åŒ– (< 10 ä¸ª)
- âœ… TDD é©±åŠ¨è´¨é‡ (æµ‹è¯•å…ˆè¡Œ)
- âœ… çŸ¥è¯†å¤åˆ (æ¯æ¬¡æ›´å®¹æ˜“)
- âœ… æ‰¹é‡æ“ä½œ (å‡å°‘ API è°ƒç”¨)
- âœ… Git Worktrees (å¹¶è¡Œå¼€å‘)
- âœ… æŒç»­ä¼˜åŒ–å·¥ä½œæµ (æ¯æœˆå®¡æŸ¥)

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:

1. å®‰è£… Compound Engineering Plugin
2. è¿è¡Œç¬¬ä¸€ä¸ªå®Œæ•´å·¥ä½œæµ (/workflows:brainstorm â†’ work)
3. åˆ›å»º 3-5 ä¸ªé¡¹ç›®ç‰¹å®šæŠ€èƒ½
4. é…ç½® Git Hooks è‡ªåŠ¨åŒ–
5. åŠ å…¥ç¤¾åŒº,åˆ†äº«ç»éªŒ

**èµ„æºé“¾æ¥**:

- **å®˜æ–¹æ–‡æ¡£**: https://docs.anthropic.com/claude/docs
- **Compound Engineering Plugin**: https://github.com/EveryInc/compound-engineering-plugin
- **Everything Claude Code**: https://github.com/affaan-m/everything-claude-code
- **ç¤¾åŒºè®ºå›**: https://discord.gg/anthropic

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£éš Claude Code æ¼”è¿›æŒç»­æ›´æ–°ã€‚æœ€åæ›´æ–°: 2026-01-31

**è´¡çŒ®**: æ¬¢è¿é€šè¿‡ PR è¡¥å……æ›´å¤šæœ€ä½³å®è·µæ¡ˆä¾‹!
